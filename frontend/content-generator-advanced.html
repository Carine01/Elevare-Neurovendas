<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elevare - Gerador de Conte√∫do (Story, Carrossel, Feed)</title>
    <style>
        /* Draft Recovery Banner */
        .draft-banner {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .draft-banner.show {
            display: flex;
        }

        .draft-banner-text {
            display: flex;
            gap: 15px;
            align-items: center;
            flex: 1;
        }

        .draft-banner button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-left: 10px;
        }

        .draft-banner .btn-restore {
            background: white;
            color: #f59e0b;
        }

        .draft-banner .btn-restore:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .draft-banner .btn-discard {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
        }

        .draft-banner .btn-discard:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Validation Messages */
        .validation-msg {
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: slideIn 0.3s ease;
        }

        .validation-msg.warning {
            background: #fef3c7;
            color: #92400e;
            border-left: 4px solid #fbbf24;
        }

        .validation-msg.error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }

        .validation-msg.success {
            background: #dcfce7;
            color: #166534;
            border-left: 4px solid #22c55e;
        }

        /* Character Counter */
        .char-counter {
            font-size: 0.85rem;
            color: #999;
            margin-top: 5px;
            display: flex;
            justify-content: space-between;
        }

        .char-counter.warning {
            color: #f59e0b;
        }

        .char-counter.error {
            color: #ef4444;
        }

        /* Status Badge */
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 8px;
        }

        .status-badge.ready {
            background: #dcfce7;
            color: #166534;
        }

        .status-badge.warning {
            background: #fef3c7;
            color: #92400e;
        }

        .status-badge.error {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Draft Banner Enhanced */
        .draft-info {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .draft-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .draft-preview {
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Publish Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .modal-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .option-btn {
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            background: white;
        }

        .option-btn:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateY(-2px);
        }

        .option-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .option-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .option-label {
            font-weight: 600;
        }

        .schedule-form {
            display: none;
        }

        .schedule-form.show {
            display: block;
        }

        .form-field {
            margin-bottom: 15px;
        }

        .form-field label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .form-field input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        .modal-actions button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-confirm {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-cancel {
            background: #f0f0f0;
            color: #333;
        }

        .btn-cancel:hover {
            background: #e0e0e0;
        }

        /* Scheduled Posts Panel */
        .scheduled-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .scheduled-panel h3 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .scheduled-list {
            display: grid;
            gap: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .scheduled-item {
            background: #f9f9f9;
            border-left: 4px solid #667eea;
            padding: 12px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .scheduled-item-info {
            flex: 1;
        }

        .scheduled-item-type {
            font-size: 0.9rem;
            color: #999;
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .scheduled-item-time {
            color: #667eea;
            font-weight: 600;
            margin-top: 5px;
        }

        .scheduled-item-actions {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }

        .btn-edit {
            background: #e3f2fd;
            color: #1976d2;
        }

        .btn-edit:hover {
            background: #bbdefb;
        }

        .btn-delete {
            background: #ffebee;
            color: #c62828;
        }

        .btn-delete:hover {
            background: #ffcdd2;
        }

        /* Sync Toggle */
        .sync-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 8px;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: #ccc;
            border-radius: 13px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.on {
            background: #22c55e;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
        }

        .toggle-switch.on::after {
            left: 26px;
        }

        /* History Filters */
        .history-filters {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .filter-btn {
            padding: 6px 12px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .filter-btn:hover {
            border-color: #667eea;
        }

        /* Diff Highlight */
        .diff-added {
            background: #dcfce7;
            color: #166534;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .diff-removed {
            background: #fee2e2;
            color: #991b1b;
            text-decoration: line-through;
            padding: 2px 4px;
            border-radius: 3px;
        }

        @keyframes slideIn {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Edit History Timeline */
        .history-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .history-panel h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .history-timeline {
            border-left: 3px solid #667eea;
            padding-left: 15px;
        }

        .history-item {
            margin-bottom: 15px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .history-item:hover {
            background: #e8f0ff;
            border-left: 3px solid #667eea;
            margin-left: -3px;
        }

        .history-time {
            font-size: 0.85rem;
            color: #999;
            display: block;
        }

        .history-change {
            font-size: 0.9rem;
            color: #333;
            margin-top: 5px;
            font-weight: 500;
        }

        .history-revert {
            font-size: 0.8rem;
            color: #667eea;
            cursor: pointer;
            margin-top: 5px;
            text-decoration: underline;
        }

        /* Sync Indicator */
        .sync-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #22c55e;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* QUICK MODE - Modo R√°pido */
        .quick-mode-btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .quick-mode-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
        }

        #quick-mode-modal .modal-content {
            max-width: 600px;
            width: 90%;
        }

        .quick-mode-steps {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }

        .quick-mode-steps::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: #e0e0e0;
            z-index: 0;
        }

        .quick-step {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .quick-step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e0e0e0;
            color: #999;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: 700;
            transition: all 0.3s;
        }

        .quick-step.active .quick-step-circle {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: scale(1.1);
        }

        .quick-step.completed .quick-step-circle {
            background: #22c55e;
            color: white;
        }

        .quick-step-label {
            font-size: 0.85rem;
            color: #666;
        }

        .quick-step.active .quick-step-label {
            color: #667eea;
            font-weight: 600;
        }

        .quick-mode-content {
            min-height: 300px;
        }

        .quick-section {
            display: none;
        }

        .quick-section.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .quick-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .quick-option {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-option:hover {
            border-color: #667eea;
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .quick-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
        }

        .quick-option-emoji {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .quick-option-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .quick-option-desc {
            font-size: 0.8rem;
            color: #666;
        }

        .quick-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        .quick-nav button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-btn-back {
            background: #f0f0f0;
            color: #333;
        }

        .quick-btn-back:hover {
            background: #e0e0e0;
        }

        .quick-btn-next {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .quick-btn-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .quick-btn-next:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Visual Themes */
        .theme-selector {
            display: none;
            position: fixed;
            top: 80px;
            right: 20px;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            min-width: 250px;
        }

        .theme-selector.show {
            display: block;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 15px;
        }

        .theme-card {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .theme-card:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .theme-card.active {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
        }

        .theme-preview {
            width: 100%;
            height: 60px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .theme-name {
            font-weight: 600;
            font-size: 0.9rem;
            color: #333;
        }
    </style>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* ===== MAIN LAYOUT ===== */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 1400px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ===== TABS ===== */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }

        .tab-btn {
            flex: 1;
            padding: 12px 20px;
            background: transparent;
            border: 2px solid transparent;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .tab-btn.active {
            background: white;
            color: #667eea;
            border-color: white;
        }

        /* ===== FORMS ===== */
        .form-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .form-section h2 {
            color: #333;
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #555;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* ===== PREVIEW ===== */
        .preview-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .preview-section h2 {
            color: #333;
            font-size: 1.5rem;
            margin-bottom: 20px;
        }

        .preview-container {
            display: flex;
            justify-content: center;
            align-items: center;
            background: #f5f5f5;
            border-radius: 12px;
            aspect-ratio: 9/16;
            overflow: hidden;
            position: relative;
            max-height: 600px;
        }

        /* STORY PREVIEW (1080x1920) */
        .story-preview {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 30px 20px;
            color: white;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            position: relative;
        }

        /* CARROSSEL PREVIEW (1080x1350) */
        .carrossel-preview {
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .slide-counter {
            position: absolute;
            top: 10px;
            right: 15px;
            background: rgba(0, 0, 0, 0.6);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .slide-content {
            text-align: center;
            padding: 40px 20px;
        }

        .slide-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
        }

        .slide-text {
            font-size: 1rem;
            color: #666;
            line-height: 1.6;
        }

        .progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: #e0e0e0;
        }

        .progress-fill {
            height: 100%;
            background: #667eea;
            width: 25%;
        }

        /* FEED PREVIEW (1080x1080) */
        .feed-preview {
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            flex-direction: column;
        }

        .feed-header {
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .feed-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .feed-user {
            font-weight: 600;
            color: #333;
        }

        .feed-image {
            flex: 1;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .feed-actions {
            padding: 12px 15px;
            display: flex;
            gap: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .action-btn {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 1.5rem;
            transition: color 0.3s ease;
        }

        .action-btn:hover {
            color: #667eea;
        }

        .feed-caption {
            padding: 15px;
            font-size: 0.9rem;
            color: #333;
            line-height: 1.5;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }

        /* ===== BUTTONS ===== */
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #f5f5f5;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        /* ===== AI GENERATION ===== */
        .ai-section {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .ai-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        @media (max-width: 768px) {
            .ai-options {
                grid-template-columns: 1fr;
            }
        }

        .ai-option {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .ai-option:hover {
            border-color: #667eea;
            background: #f5f5ff;
        }

        .ai-option.selected {
            border-color: #667eea;
            background: #ede9fe;
            font-weight: 600;
        }

        /* ===== STATS ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            margin-top: 10px;
            font-size: 0.95rem;
        }

        /* ===== LOADING ===== */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .loading.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== NOTIFICATIONS ===== */
        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: white;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            animation: slideIn 0.3s ease;
            display: none;
        }

        .notification.show {
            display: block;
        }

        .notification.success {
            border-left: 4px solid #10b981;
        }

        .notification.error {
            border-left: 4px solid #ef4444;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* ===== COLOR PICKER ===== */
        .color-group {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .color-option {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: #333;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        /* ===== FILTROS E CONTROLES ===== */
        .filter-slider {
            margin-bottom: 15px;
        }

        .filter-slider label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .filter-slider input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .filter-slider input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .filter-slider input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .btn-small {
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        .btn-info {
            background: #0891b2;
            color: white;
        }

        .btn-info:hover {
            background: #0e7490;
        }

        .btn-warning {
            background: #ea580c;
            color: white;
        }

        .btn-warning:hover {
            background: #c2410c;
        }

        .btn-copy {
            background: #8b5cf6;
            color: white;
        }

        .btn-copy:hover {
            background: #7c3aed;
        }

        .btn-position {
            flex: 1;
            padding: 8px 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: 2px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .btn-position:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-position.active {
            background: #5a67d8;
            border-color: white;
            box-shadow: 0 0 0 2px rgba(90, 103, 216, 0.2);
        }

        /* Preview Story Text - Vertical Positioning */
        #preview-story-text {
            position: absolute;
            width: 80%;
            left: 10%;
            transition: top 0.3s ease;
        }

        .template-item {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
        }

        .template-item:hover {
            border-color: #667eea;
            background: #f5f5ff;
            transform: translateY(-2px);
        }

        .template-item-preview {
            width: 100%;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 4px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }
    </style>
</head>
<body onload="checkDraftRecovery(); updateHistoryDisplay()">
    <div class="container">
        <!-- DRAFT RECOVERY BANNER -->
        <div id="draft-banner" class="draft-banner">
            <div class="draft-banner-text">
                <span>üìã Voc√™ tem draft(s) salvo(s):</span>
                <div class="draft-info">
                    <div id="draft-story-item" class="draft-item" style="display: none;">üì± Story: <span class="draft-preview" id="draft-story-preview"></span></div>
                    <div id="draft-carrossel-item" class="draft-item" style="display: none;">üé† Carrossel: <span class="draft-preview" id="draft-carrossel-preview"></span></div>
                    <div id="draft-feed-item" class="draft-item" style="display: none;">üì∏ Feed: <span class="draft-preview" id="draft-feed-preview"></span></div>
                    <div id="draft-time-item" class="draft-item" style="font-size: 0.8rem;"></div>
                </div>
            </div>
            <div>
                <button class="btn-restore" onclick="restoreDraft()">Recuperar</button>
                <button class="btn-discard" onclick="discardDraft()">Descartar</button>
            </div>
        </div>

        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1>‚ú® Elevare - Gerador Inteligente de Conte√∫do</h1>
                    <p>Crie Stories, Carrosseis e Feed Posts com IA em segundos</p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button id="theme-toggle-btn" class="quick-mode-btn" onclick="toggleThemeSelector()" style="display: none; background: linear-gradient(135deg, #667eea, #764ba2);">
                        üé® Temas
                    </button>
                    <button class="quick-mode-btn" onclick="openBrandProfile()" style="background: linear-gradient(135deg, #8b5cf6, #a855f7);">
                        ‚öôÔ∏è Perfil da Marca
                    </button>
                    <button class="quick-mode-btn" onclick="openQuickMode()">
                        ‚ö° Modo R√°pido
                        <span style="font-size: 0.8rem; opacity: 0.9;">(60s)</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- THEME SELECTOR PANEL -->
        <div class="theme-selector" id="theme-selector">
            <h3 style="margin-bottom: 15px; color: #333;">üé® Temas Visuais</h3>
            <p style="font-size: 0.85rem; color: #666; margin-bottom: 15px;">Aplica em toda sequ√™ncia</p>
            <div class="theme-grid">
                <div class="theme-card" onclick="applyTheme('elegante')">
                    <div class="theme-preview" style="background: linear-gradient(135deg, #1e3a8a, #6366f1);"></div>
                    <div class="theme-name">Elegante</div>
                </div>
                <div class="theme-card" onclick="applyTheme('bold')">
                    <div class="theme-preview" style="background: linear-gradient(135deg, #dc2626, #f97316);"></div>
                    <div class="theme-name">Bold</div>
                </div>
                <div class="theme-card" onclick="applyTheme('clean')">
                    <div class="theme-preview" style="background: linear-gradient(135deg, #f5f5f5, #d4d4d8);"></div>
                    <div class="theme-name">Clean</div>
                </div>
                <div class="theme-card" onclick="applyTheme('luxury')">
                    <div class="theme-preview" style="background: linear-gradient(135deg, #78350f, #fbbf24);"></div>
                    <div class="theme-name">Luxury</div>
                </div>
                <div class="theme-card" onclick="applyTheme('fresh')">
                    <div class="theme-preview" style="background: linear-gradient(135deg, #10b981, #6ee7b7);"></div>
                    <div class="theme-name">Fresh</div>
                </div>
                <div class="theme-card" onclick="applyTheme('warm')">
                    <div class="theme-preview" style="background: linear-gradient(135deg, #f59e0b, #fbbf24);"></div>
                    <div class="theme-name">Warm</div>
                </div>
            </div>
        </div>

        <!-- TABS PARA ESCOLHER O TIPO DE CONTE√öDO -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('story')">üì± Story</button>
            <button class="tab-btn" onclick="switchTab('carrossel')">üé† Carrossel</button>
            <button class="tab-btn" onclick="switchTab('feed')">üì∏ Feed Post</button>
        </div>

        <!-- MAIN GRID: FORM + PREVIEW -->
        <div class="main-grid">
            <!-- STORY TAB -->
            <div id="story-form" class="form-section" style="display: block;">
                <h2>üì± Criar Story</h2>

                <div class="form-group">
                    <label>T√≠tulo da Story</label>
                    <input type="text" placeholder="Ex: Harmoniza√ß√£o Facial - Resultado Natural" id="story-title">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Sequ√™ncia de Venda</label>
                        <select id="story-type">
                            <option value="atrair">üéØ Atrair - Quebra de padr√£o e curiosidade</option>
                            <option value="aquecer">üî• Aquecer - Construir confian√ßa e relacionamento</option>
                            <option value="converter">üí∞ Converter - Gerar vendas e a√ß√µes</option>
                            <option value="educar">üìö Educar - Ensinar e estabelecer autoridade</option>
                            <option value="reposicionar">‚ö° Reposicionar - Redefinir posicionamento</option>
                            <option value="reativar">üîÑ Reativar - Reconectar p√∫blico antigo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Procedimento</label>
                        <input type="text" placeholder="Ex: Harmoniza√ß√£o Facial, Botox" id="story-procedure">
                    </div>
                </div>

                <div class="form-group">
                    <label>Texto Principal (m√°x 50 caracteres)</label>
                    <textarea id="story-text" placeholder="Seu texto aqui..." maxlength="100"></textarea>
                </div>

                <div class="form-group">
                    <label>Imagem de Fundo (ou deixe para cor s√≥lida)</label>
                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 10px;">
                        <!-- Abas de fontes de imagem -->
                        <button onclick="switchImageSource('unsplash')" style="padding: 10px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; font-weight: 600;">üì∑ Unsplash</button>
                        <button onclick="switchImageSource('pexels')" style="padding: 10px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; font-weight: 600;">üéûÔ∏è Pexels</button>
                        <button onclick="switchImageSource('pixabay')" style="padding: 10px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; font-weight: 600;">üì∏ Pixabay</button>
                        <button onclick="switchImageSource('ai')" style="padding: 10px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; font-weight: 600;">ü§ñ IA</button>
                        <button onclick="switchImageSource('color')" style="padding: 10px; background: white; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer; font-weight: 600;">üé® Cor</button>
                    </div>
                    
                    <!-- Galeria de imagens -->
                    <div id="image-gallery-container" style="margin-top: 15px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; max-height: 200px; overflow-y: auto; border: 2px solid #e0e0e0; padding: 10px; border-radius: 8px; display: none;">
                        <!-- Imagens carregar√£o dinamicamente -->
                    </div>
                    
                    <!-- Busca de imagens -->
                    <div id="image-search" style="margin-top: 10px; display: none;">
                        <input type="text" id="search-images" placeholder="Buscar: harmoniza√ß√£o, botox, spa..." style="width: calc(100% - 60px); padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px;">
                        <button onclick="searchImages()" style="width: 50px; padding: 10px; margin-left: 5px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">üîç</button>
                    </div>
                    
                    <!-- Prompt para IA -->
                    <div id="ai-prompt-container" style="margin-top: 10px; display: none;">
                        <textarea id="ai-prompt" placeholder="Descreva a imagem: ex: 'Mulher recebendo massagem facial em spa luxuoso'" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; min-height: 80px;"></textarea>
                        <button onclick="generateImageWithAI()" style="width: 100%; padding: 10px; margin-top: 10px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; margin-top: 10px;">üé® Gerar Imagem com IA</button>
                    </div>
                </div>

                <!-- POSICIONAMENTO DO TEXTO (NOVO) -->
                <div class="form-row">
                    <div class="form-group">
                        <label>üìç Posi√ß√£o Vertical do Texto</label>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <input type="range" id="story-position-y" min="0" max="100" value="50" style="flex: 1;" oninput="updateStoryPreview()">
                            <span id="position-y-label" style="min-width: 50px; font-weight: 600; color: #667eea;">Centro</span>
                        </div>
                        <div style="display: flex; gap: 8px; margin-top: 10px;">
                            <button type="button" class="btn-position" onclick="setPosition(20)">üîù Topo</button>
                            <button type="button" class="btn-position" onclick="setPosition(50)">üîÑ Centro</button>
                            <button type="button" class="btn-position" onclick="setPosition(80)">üîΩ Rodap√©</button>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Cor de Fundo</label>
                        <div class="color-group">
                            <div class="color-option selected" style="background: #F5F5F5; background-color: #F5F5F5" onclick="selectColor('story', '#F5F5F5')"></div>
                            <div class="color-option" style="background: #667eea" onclick="selectColor('story', '#667eea')"></div>
                            <div class="color-option" style="background: #764ba2" onclick="selectColor('story', '#764ba2')"></div>
                            <div class="color-option" style="background: #10b981" onclick="selectColor('story', '#10b981')"></div>
                            <div class="color-option" style="background: #f59e0b" onclick="selectColor('story', '#f59e0b')"></div>
                        </div>
                    </div>
                </div>

                <div class="ai-section">
                    <h3>ü§ñ Gerar com IA Lucresia</h3>
                    <button class="btn btn-primary" onclick="generateStoryAI()">Gerar Op√ß√µes de Story</button>
                </div>

                <div class="button-group">
                    <button class="btn btn-success" onclick="saveStory()">üíæ Salvar Story</button>
                    <button class="btn btn-secondary" onclick="openPublishModal('Story')">üì§ Publicar</button>
                    <button class="btn btn-info" onclick="toggleFilters()">üé® Filtros</button>
                    <button class="btn btn-warning" onclick="exportStory()">üì• Exportar PNG/JPG</button>
                    <button class="btn btn-copy" onclick="copyTextOnly()" title="Copiar apenas texto sugerido">üìã Copiar Texto</button>
                </div>

                <!-- SYNC STYLES TOGGLE -->
                <div class="sync-toggle">
                    <span>üîÑ Sincronizar estilos entre abas (cor, fonte, tamanho)</span>
                    <div class="toggle-switch" id="sync-toggle" onclick="toggleStyleSync()"></div>
                </div>

                <!-- FILTROS AVAN√áADOS -->
                <div id="filters-section" style="display: none; background: #f9f9f9; padding: 20px; border-radius: 10px; margin-top: 15px;">
                    <h3 style="margin-bottom: 15px; color: #333;">üé® Filtros & Efeitos</h3>
                    
                    <div class="filter-slider">
                        <label>‚ú® Brilho: <span id="brightness-value">100</span>%</label>
                        <input type="range" id="brightness" min="0" max="200" value="100" oninput="applyFilter('brightness')">
                    </div>
                    <div class="filter-slider">
                        <label>üîß Contraste: <span id="contrast-value">100</span>%</label>
                        <input type="range" id="contrast" min="0" max="200" value="100" oninput="applyFilter('contrast')">
                    </div>
                    <div class="filter-slider">
                        <label>üé® Satura√ß√£o: <span id="saturation-value">100</span>%</label>
                        <input type="range" id="saturation" min="0" max="200" value="100" oninput="applyFilter('saturation')">
                    </div>
                    <div class="filter-slider">
                        <label>üå´Ô∏è Blur: <span id="blur-value">0</span>px</label>
                        <input type="range" id="blur" min="0" max="20" value="0" oninput="applyFilter('blur')">
                    </div>
                    <div class="filter-slider">
                        <label>üü§ Sepia: <span id="sepia-value">0</span>%</label>
                        <input type="range" id="sepia" min="0" max="100" value="0" oninput="applyFilter('sepia')">
                    </div>
                    <div class="filter-slider">
                        <label>‚ö´ Escala de Cinza: <span id="grayscale-value">0</span>%</label>
                        <input type="range" id="grayscale" min="0" max="100" value="0" oninput="applyFilter('grayscale')">
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-small" onclick="resetFilters()">‚Ü©Ô∏è Resetar</button>
                        <button class="btn btn-small" onclick="applyPresetFilter('vintage')">üì∏ Vintage</button>
                        <button class="btn btn-small" onclick="applyPresetFilter('noir')">‚ö´ Noir</button>
                        <button class="btn btn-small" onclick="applyPresetFilter('vibrant')">üéâ Vibrant</button>
                    </div>
                </div>

                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="btn btn-small" onclick="undoAction()" title="Ctrl+Z">‚Ü∂ Desfazer</button>
                    <button class="btn btn-small" onclick="redoAction()" title="Ctrl+Y">‚Ü∑ Refazer</button>
                    <button class="btn btn-small" onclick="toggleTemplates()">üìã Templates</button>
                </div>

                <!-- TEMPLATES -->
                <div id="templates-section" style="display: none; background: #f9f9f9; padding: 20px; border-radius: 10px; margin-top: 15px;">
                    <h3 style="margin-bottom: 15px; color: #333;">üìã Templates Pr√©-prontos</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px;" id="templates-grid"></div>
                </div>
            </div>

            <!-- CARROSSEL TAB -->
            <div id="carrossel-form" class="form-section" style="display: none;">
                <h2>üé† Criar Carrossel</h2>

                <div class="form-group">
                    <label>T√≠tulo do Carrossel</label>
                    <input type="text" placeholder="Ex: 5 Benef√≠cios da Harmoniza√ß√£o Facial" id="carrossel-title">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Tipo de Carrossel</label>
                        <select id="carrossel-type">
                            <option value="educativo">Educativo</option>
                            <option value="antes-depois">Antes & Depois</option>
                            <option value="beneficios">Benef√≠cios</option>
                            <option value="processo">Processo Passo a Passo</option>
                            <option value="faq">FAQ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>N√∫mero de Slides</label>
                        <select id="carrossel-slides">
                            <option value="3">3 slides</option>
                            <option value="4">4 slides</option>
                            <option value="5" selected>5 slides</option>
                            <option value="6">6 slides</option>
                            <option value="7">7 slides</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Procedimento</label>
                    <input type="text" placeholder="Ex: Botox" id="carrossel-procedure">
                </div>

                <div class="form-group">
                    <label>Descri√ß√£o/Contexto</label>
                    <textarea id="carrossel-description" placeholder="Descreva o conte√∫do do carrossel..."></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Cor Prim√°ria</label>
                        <div class="color-group">
                            <div class="color-option selected" style="background: #667eea" onclick="selectColor('carrossel', '#667eea')"></div>
                            <div class="color-option" style="background: #764ba2" onclick="selectColor('carrossel', '#764ba2')"></div>
                            <div class="color-option" style="background: #10b981" onclick="selectColor('carrossel', '#10b981')"></div>
                            <div class="color-option" style="background: #f59e0b" onclick="selectColor('carrossel', '#f59e0b')"></div>
                            <div class="color-option" style="background: #ef4444" onclick="selectColor('carrossel', '#ef4444')"></div>
                        </div>
                    </div>
                </div>

                <div class="ai-section">
                    <h3>ü§ñ Gerar com IA Lucresia</h3>
                    <button class="btn btn-primary" onclick="generateCarrosselAI()">Gerar Carrossel Completo</button>
                </div>

                <div class="button-group">
                    <button class="btn btn-success" onclick="saveCarrossel()">üíæ Salvar Carrossel</button>
                    <button class="btn btn-secondary" onclick="openPublishModal('Carrossel')">üì§ Publicar</button>
                </div>
            </div>

            <!-- FEED TAB -->
            <div id="feed-form" class="form-section" style="display: none;">
                <h2>üì∏ Criar Feed Post</h2>

                <div class="form-group">
                    <label>T√≠tulo do Post</label>
                    <input type="text" placeholder="Ex: Resultado Harmoniza√ß√£o Facial" id="feed-title">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Objetivo</label>
                        <select id="feed-objective">
                            <option value="vender">Vender</option>
                            <option value="educar">Educar</option>
                            <option value="engajar">Engajar</option>
                            <option value="inspirar">Inspirar</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Emo√ß√£o Alvo</label>
                        <select id="feed-emotion">
                            <option value="inspiracao">Inspira√ß√£o</option>
                            <option value="confianca">Confian√ßa</option>
                            <option value="curiosidade">Curiosidade</option>
                            <option value="desejo">Desejo</option>
                            <option value="urgencia">Urg√™ncia</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Legenda do Post (M√°x 2200 caracteres)</label>
                    <textarea id="feed-caption" placeholder="Escreva uma legenda engajante..." maxlength="2200"></textarea>
                </div>

                <div class="form-group">
                    <label>Hashtags (separadas por espa√ßo)</label>
                    <input type="text" placeholder="#harmonizacao #botox #beleza #resultados" id="feed-hashtags">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Link do CTA</label>
                        <input type="url" placeholder="https://seu-site.com" id="feed-link">
                    </div>
                    <div class="form-group">
                        <label>Texto do CTA</label>
                        <input type="text" placeholder="Clique aqui, Saiba mais, Agende agora" id="feed-cta">
                    </div>
                </div>

                <div class="ai-section">
                    <h3>ü§ñ Gerar com IA Lucresia</h3>
                    <button class="btn btn-primary" onclick="generateFeedAI()">Gerar Op√ß√µes de Feed</button>
                </div>

                <div class="button-group">
                    <button class="btn btn-success" onclick="saveFeed()">üíæ Salvar Feed</button>
                    <button class="btn btn-secondary" onclick="openPublishModal('Feed')">üì§ Publicar</button>
                </div>
            </div>

            <!-- PREVIEW SECTION -->
            <div class="preview-section">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h2>üëÄ Pr√©-visualiza√ß√£o</h2>
                    <button class="btn btn-secondary" onclick="duplicateCurrentSequence()">üîÑ Duplicar Sequ√™ncia</button>
                </div>
                
                <!-- STORY PREVIEW -->
                <div id="story-preview" class="preview-container" style="display: flex;">
                    <div class="story-preview" id="story-preview-content">
                        <div style="margin-top: auto;">
                            <div id="preview-story-text" style="font-size: 2rem; margin-bottom: 20px;">Seu texto aqui</div>
                        </div>
                        <div id="preview-story-cta" style="background: rgba(255, 255, 255, 0.2); padding: 15px 30px; border-radius: 8px; margin-bottom: 20px;">
                            Saiba mais
                        </div>
                        <div style="margin-top: auto; font-size: 3rem;">‚ú®</div>
                    </div>
                </div>

                <!-- CARROSSEL PREVIEW -->
                <div id="carrossel-preview" class="preview-container" style="display: none;">
                    <div class="carrossel-preview" id="carrossel-preview-content">
                        <div class="slide-counter">
                            <span id="current-slide">1</span> / <span id="total-slides">5</span>
                        </div>
                        <div class="slide-content">
                            <div class="slide-title" id="preview-slide-title">T√≠tulo do Slide</div>
                            <div class="slide-text" id="preview-slide-text">Conte√∫do do slide aqui</div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                    </div>
                </div>

                <!-- FEED PREVIEW -->
                <div id="feed-preview" class="preview-container" style="display: none;">
                    <div class="feed-preview" id="feed-preview-content">
                        <div class="feed-header">
                            <div class="feed-avatar"></div>
                            <div class="feed-user">Sua Cl√≠nica ‚úì</div>
                        </div>
                        <div class="feed-image">
                            Imagem do Feed
                        </div>
                        <div class="feed-actions">
                            <button class="action-btn">‚ù§Ô∏è</button>
                            <button class="action-btn">üí¨</button>
                            <button class="action-btn">‚úàÔ∏è</button>
                            <button class="action-btn" style="margin-left: auto;">üîñ</button>
                        </div>
                        <div class="feed-caption" id="preview-feed-caption">
                            Sua legenda aqui...
                        </div>
                    </div>
                </div>

                <!-- STATS -->
                <div class="stats-grid" style="margin-top: 0;">
                    <div class="stat-card">
                        <div class="stat-number" id="stat-stories">0</div>
                        <div class="stat-label">Stories Criadas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="stat-carrosseis">0</div>
                        <div class="stat-label">Carrosseis Criados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="stat-feeds">0</div>
                        <div class="stat-label">Feed Posts Criados</div>
                    </div>
                </div>

                <!-- EDIT HISTORY PANEL -->
                <div class="history-panel">
                    <h3>‚è±Ô∏è Hist√≥rico de Edi√ß√µes</h3>
                    <div id="history-panel"></div>
                </div>

                <!-- SCHEDULED POSTS PANEL -->
                <div class="scheduled-panel">
                    <h3>üìÖ Postagens Agendadas</h3>
                    <div id="scheduled-posts-panel"></div>
                </div>

                <!-- COPIES PANEL -->
                <div class="scheduled-panel">
                    <h3>üîÑ C√≥pias de Sequ√™ncia</h3>
                    <div id="copies-panel"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- LOADING SPINNER -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <!-- NOTIFICATION -->
    <div class="notification" id="notification">
        <span id="notification-message"></span>
    </div>

    <!-- PUBLISH MODAL -->
    <div class="modal-overlay" id="publish-modal">
        <div class="modal-content">
            <div class="modal-title">
                üìÖ Escolha como publicar
            </div>

            <div class="modal-options">
                <div class="option-btn" onclick="selectPublishOption('now', this)">
                    <div class="option-icon">‚ö°</div>
                    <div class="option-label">Publicar Agora</div>
                    <div style="font-size: 0.85rem; color: #999; margin-top: 5px;">Publicar imediatamente</div>
                </div>
                <div class="option-btn" onclick="selectPublishOption('schedule', this)">
                    <div class="option-icon">üìÖ</div>
                    <div class="option-label">Agendar</div>
                    <div style="font-size: 0.85rem; color: #999; margin-top: 5px;">Escolher data e hora</div>
                </div>
            </div>

            <div class="schedule-form" id="schedule-form">
                <div class="form-field">
                    <label>üìÖ Data</label>
                    <input type="date" id="schedule-date" required>
                </div>
                <div class="form-field">
                    <label>üïê Hora</label>
                    <input type="time" id="schedule-time" required>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn-confirm" id="confirm-btn" onclick="confirmPublish()" disabled>
                    Confirmar
                </button>
                <button class="btn-cancel" onclick="closePublishModal()">
                    Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- QUICK MODE MODAL -->
    <div class="modal-overlay" id="quick-mode-modal">
        <div class="modal-content">
            <div class="modal-title">
                ‚ö° Modo R√°pido - Crie sequ√™ncia completa em 60 segundos
            </div>

            <!-- Steps indicator -->
            <div class="quick-mode-steps">
                <div class="quick-step active" id="step-1">
                    <div class="quick-step-circle">1</div>
                    <div class="quick-step-label">Objetivo</div>
                </div>
                <div class="quick-step" id="step-2">
                    <div class="quick-step-circle">2</div>
                    <div class="quick-step-label">Tema</div>
                </div>
                <div class="quick-step" id="step-3">
                    <div class="quick-step-circle">3</div>
                    <div class="quick-step-label">Gerar</div>
                </div>
            </div>

            <!-- Step 1: Objetivo -->
            <div class="quick-mode-content">
                <div class="quick-section active" id="quick-step-1">
                    <h3 style="margin-bottom: 10px; color: #333;">Qual √© o seu objetivo?</h3>
                    <p style="color: #666; margin-bottom: 20px;">Escolha o objetivo principal do seu conte√∫do</p>
                    
                    <div class="quick-options">
                        <div class="quick-option" onclick="selectQuickOption('objetivo', 'converter', this)">
                            <div class="quick-option-emoji">üí∞</div>
                            <div class="quick-option-label">Converter</div>
                            <div class="quick-option-desc">Gerar vendas</div>
                        </div>
                        <div class="quick-option" onclick="selectQuickOption('objetivo', 'educar', this)">
                            <div class="quick-option-emoji">üìö</div>
                            <div class="quick-option-label">Educar</div>
                            <div class="quick-option-desc">Ensinar seu p√∫blico</div>
                        </div>
                        <div class="quick-option" onclick="selectQuickOption('objetivo', 'engajar', this)">
                            <div class="quick-option-emoji">‚ù§Ô∏è</div>
                            <div class="quick-option-label">Engajar</div>
                            <div class="quick-option-desc">Aumentar intera√ß√£o</div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Tema Visual -->
                <div class="quick-section" id="quick-step-2">
                    <h3 style="margin-bottom: 10px; color: #333;">Escolha o tema visual</h3>
                    <p style="color: #666; margin-bottom: 20px;">O tema ser√° aplicado em toda a sequ√™ncia</p>
                    
                    <div class="quick-options">
                        <div class="quick-option" onclick="selectQuickOption('tema', 'elegante', this)">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #1e3a8a, #6366f1);"></div>
                            <div class="quick-option-label">Elegante</div>
                            <div class="quick-option-desc">Sofisticado</div>
                        </div>
                        <div class="quick-option" onclick="selectQuickOption('tema', 'bold', this)">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #dc2626, #f97316);"></div>
                            <div class="quick-option-label">Bold</div>
                            <div class="quick-option-desc">Impacto m√°ximo</div>
                        </div>
                        <div class="quick-option" onclick="selectQuickOption('tema', 'clean', this)">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #f5f5f5, #d4d4d8);"></div>
                            <div class="quick-option-label">Clean</div>
                            <div class="quick-option-desc">Minimalista</div>
                        </div>
                        <div class="quick-option" onclick="selectQuickOption('tema', 'luxury', this)">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #78350f, #fbbf24);"></div>
                            <div class="quick-option-label">Luxury</div>
                            <div class="quick-option-desc">Premium</div>
                        </div>
                        <div class="quick-option" onclick="selectQuickOption('tema', 'fresh', this)">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #10b981, #6ee7b7);"></div>
                            <div class="quick-option-label">Fresh</div>
                            <div class="quick-option-desc">Vibrante</div>
                        </div>
                        <div class="quick-option" onclick="selectQuickOption('tema', 'warm', this)">
                            <div class="theme-preview" style="background: linear-gradient(135deg, #f59e0b, #fbbf24);"></div>
                            <div class="quick-option-label">Warm</div>
                            <div class="quick-option-desc">Acolhedor</div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Procedimento -->
                <div class="quick-section" id="quick-step-3">
                    <h3 style="margin-bottom: 10px; color: #333;">Qual procedimento/servi√ßo?</h3>
                    <p style="color: #666; margin-bottom: 20px;">Digite o nome do procedimento para gerar conte√∫do personalizado</p>
                    
                    <div style="margin-top: 20px;">
                        <input 
                            type="text" 
                            id="quick-procedure" 
                            placeholder="Ex: Harmoniza√ß√£o Facial, Botox, Preenchimento Labial..." 
                            style="width: 100%; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1rem;"
                        >
                    </div>

                    <div style="margin-top: 20px; padding: 15px; background: white; border: 2px solid #e0e0e0; border-radius: 10px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="quick-generate-all" style="width: 20px; height: 20px;">
                            <span style="font-weight: 600; color: #333;">üöÄ Gerar TUDO (Story + Carrossel + Feed)</span>
                        </label>
                        <p style="font-size: 0.85rem; color: #666; margin: 8px 0 0 30px;">
                            Cria sequ√™ncia completa nos 3 formatos de uma vez
                        </p>
                    </div>

                    <div style="margin-top: 30px; padding: 20px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); border-radius: 10px;">
                        <h4 style="color: #667eea; margin-bottom: 10px;">üìä O que ser√° criado:</h4>
                        <ul style="list-style: none; padding: 0; color: #666;" id="quick-mode-preview">
                            <li style="padding: 8px 0;">‚úÖ 6 Stories profissionais com textos de neurovendas</li>
                            <li style="padding: 8px 0;">‚úÖ Visual completo aplicado automaticamente</li>
                            <li style="padding: 8px 0;">‚úÖ CTAs otimizados para convers√£o</li>
                            <li style="padding: 8px 0;">‚úÖ Pronto para postar em 60 segundos!</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="quick-nav">
                <button class="quick-btn-back" onclick="quickModeBack()" style="display: none;">
                    ‚Üê Voltar
                </button>
                <button class="quick-btn-next" onclick="quickModeNext()" id="quick-next-btn" disabled>
                    Pr√≥ximo ‚Üí
                </button>
            </div>
        </div>
    </div>

    <!-- BRAND PROFILE MODAL -->
    <div class="modal-overlay" id="brand-profile-modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-title">
                ‚öôÔ∏è Perfil da Marca - Personaliza√ß√£o Lucresia
            </div>

            <div style="max-height: 500px; overflow-y: auto; padding: 20px 10px;">
                <div class="form-group">
                    <label>Nome da Marca/Cl√≠nica</label>
                    <input type="text" id="brand-name" placeholder="Ex: Cl√≠nica Est√©tica Premium" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                </div>

                <div class="form-group">
                    <label>Segmento</label>
                    <input type="text" id="brand-segment" placeholder="Ex: est√©tica avan√ßada, harmoniza√ß√£o facial" value="est√©tica avan√ßada" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                </div>

                <div class="form-group">
                    <label>Tom de Voz</label>
                    <select id="brand-tone" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                        <option value="autoridade">Autoridade (Sou refer√™ncia)</option>
                        <option value="acolhedor">Acolhedor (Estou aqui para voc√™)</option>
                        <option value="educativo">Educativo (Vou te ensinar)</option>
                        <option value="premium">Premium (Exclusivo e sofisticado)</option>
                        <option value="inspirador">Inspirador (Transforme-se)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Instagram</label>
                    <input type="text" id="brand-instagram" placeholder="@suaclinica" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                </div>

                <div class="form-group">
                    <label>Telefone/WhatsApp</label>
                    <input type="text" id="brand-phone" placeholder="(11) 99999-9999" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                </div>

                <div class="form-group">
                    <label>P√∫blico Principal</label>
                    <textarea id="brand-audience" placeholder="Ex: Mulheres 30-50 anos buscando rejuvenescimento e autoestima" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; min-height: 60px;">Mulheres 30-50 anos buscando rejuvenescimento</textarea>
                </div>

                <div class="form-group">
                    <label>Palavras Estrat√©gicas (separadas por v√≠rgula)</label>
                    <input type="text" id="brand-keywords" placeholder="harmoniza√ß√£o, rejuvenescimento, t√©cnica exclusiva" value="harmoniza√ß√£o, rejuvenescimento, t√©cnica exclusiva" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                </div>

                <div class="form-group">
                    <label>Palavras PROIBIDAS (separadas por v√≠rgula)</label>
                    <input type="text" id="brand-forbidden" placeholder="barato, promo√ß√£o, desconto" value="barato, promo√ß√£o" style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px;">
                </div>

                <div style="background: #f0f9ff; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <p style="font-size: 0.9rem; color: #0369a1; margin: 0;">
                        üí° <strong>Dica:</strong> Este perfil ser√° usado pela IA Lucresia para gerar conte√∫dos personalizados com o DNA da sua marca.
                    </p>
                </div>
            </div>

            <div class="modal-actions" style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e0e0e0;">
                <button class="btn-cancel" onclick="closeBrandProfile()">
                    Cancelar
                </button>
                <button class="btn-confirm" onclick="saveBrandProfile()">
                    üíæ Salvar Perfil
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== CONFIGURA√á√ïES E CONSTANTES =====
        const API_BASE = 'http://localhost:8000/api';
        const UNSPLASH_KEY = 'YOUR_UNSPLASH_KEY';
        const PEXELS_KEY = 'YOUR_PEXELS_KEY';

        // ===== BRAND PROFILE SYSTEM =====
        let brandProfile = JSON.parse(localStorage.getItem('elevare_brand_profile')) || null;

        function openBrandProfile() {
            const modal = document.getElementById('brand-profile-modal');
            if (!modal) return;
            // Preencher campos se existir
            if (brandProfile) {
                document.getElementById('brand-name').value = brandProfile.nome_marca || '';
                document.getElementById('brand-segment').value = brandProfile.segmento || '';
                document.getElementById('brand-tone').value = brandProfile.tom_de_voz || 'autoridade';
                document.getElementById('brand-instagram').value = brandProfile.instagram || '';
                document.getElementById('brand-phone').value = brandProfile.phone || '';
                document.getElementById('brand-audience').value = brandProfile.publico_principal || '';
                document.getElementById('brand-keywords').value = (brandProfile.palavras_chave || []).join(', ');
                document.getElementById('brand-forbidden').value = (brandProfile.palavras_evitar || []).join(', ');
            }
            modal.classList.add('show');
        }

        function closeBrandProfile() {
            const modal = document.getElementById('brand-profile-modal');
            if (modal) modal.classList.remove('show');
        }

        function saveBrandProfile() {
            brandProfile = {
                nome_marca: document.getElementById('brand-name').value.trim() || 'Sua Cl√≠nica',
                segmento: document.getElementById('brand-segment').value.trim() || 'est√©tica avan√ßada',
                tom_de_voz: document.getElementById('brand-tone').value,
                instagram: document.getElementById('brand-instagram').value.trim(),
                phone: document.getElementById('brand-phone').value.trim(),
                publico_principal: document.getElementById('brand-audience').value.trim(),
                palavras_chave: document.getElementById('brand-keywords').value.split(',').map(s => s.trim()).filter(Boolean),
                palavras_evitar: document.getElementById('brand-forbidden').value.split(',').map(s => s.trim()).filter(Boolean),
                personalidade: [],
                valores: []
            };
            localStorage.setItem('elevare_brand_profile', JSON.stringify(brandProfile));
            closeBrandProfile();
            showNotification('‚úÖ Perfil da marca salvo!', 'success');
        }

        function applyBrandPlaceholders(text) {
            if (!text || !brandProfile) return text;
            return text
                .replace(/\{\{MARCA\}\}/g, brandProfile.nome_marca || '')
                .replace(/\{\{INSTAGRAM\}\}/g, brandProfile.instagram || '')
                .replace(/\{\{PHONE\}\}/g, brandProfile.phone || '');
        }

        // ===== PUBLISH SCHEDULING SYSTEM =====
        let scheduledPosts = JSON.parse(localStorage.getItem('elevare_scheduled_posts')) || [];
        let currentPublishOption = null;

        function openPublishModal(type) {
            currentPublishOption = null;
            document.getElementById('publish-modal').classList.add('show');
            document.getElementById('schedule-form').classList.remove('show');
            document.getElementById('confirm-btn').disabled = true;
            document.getElementById('confirm-btn').textContent = 'Confirmar';
        }

        function selectPublishOption(option, element) {
            currentPublishOption = option;
            
            // Remover sele√ß√£o anterior
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            element.classList.add('selected');

            if (option === 'now') {
                document.getElementById('schedule-form').classList.remove('show');
                document.getElementById('confirm-btn').disabled = false;
                document.getElementById('confirm-btn').textContent = '‚ö° Publicar Agora';
            } else if (option === 'schedule') {
                document.getElementById('schedule-form').classList.add('show');
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('schedule-date').value = today;
                document.getElementById('schedule-date').min = today;
                validateScheduleForm();
            }
        }

        function validateScheduleForm() {
            const date = document.getElementById('schedule-date').value;
            const time = document.getElementById('schedule-time').value;
            const isValid = date && time && isScheduleTimeValid(date, time);
            document.getElementById('confirm-btn').disabled = !isValid;
        }

        function isScheduleTimeValid(date, time) {
            if (!date || !time) return false;
            const scheduledTime = new Date(`${date}T${time}`);
            const now = new Date();
            return scheduledTime > now;
        }

        function confirmPublish() {
            const activeTab = document.querySelector('.tab.active')?.textContent.trim();
            
            if (!activeTab) {
                showNotification('‚ùå Selecione uma aba antes', 'error');
                return;
            }

            if (currentPublishOption === 'now') {
                publishNow(activeTab);
                closePublishModal();
            } else if (currentPublishOption === 'schedule') {
                schedulePost(activeTab);
                closePublishModal();
            }
        }

        function publishNow(type) {
            const data = getContentData(type);
            
            const post = {
                id: Date.now(),
                type,
                data,
                publishedAt: new Date().toLocaleString('pt-BR'),
                status: 'published'
            };

            // Simular publica√ß√£o
            showNotification(`‚úÖ ${type} publicada com sucesso!`, 'success');
            updateStats(type);
            saveToHistory(type, data);
            
            // Limpar campos
            if (type === 'Story') {
                document.getElementById('story-text').value = '';
                updateStoryPreview();
            } else if (type === 'Carrossel') {
                document.getElementById('carrossel-description').value = '';
                updateCarrosselPreview();
            } else {
                document.getElementById('feed-text').value = '';
                updateFeedPreview();
            }
        }

        function schedulePost(type) {
            const date = document.getElementById('schedule-date').value;
            const time = document.getElementById('schedule-time').value;
            const data = getContentData(type);

            const post = {
                id: Date.now(),
                type,
                data,
                scheduledFor: `${date}T${time}`,
                scheduledForDisplay: formatScheduleTime(date, time),
                status: 'scheduled',
                createdAt: new Date().toISOString()
            };

            scheduledPosts.unshift(post);
            localStorage.setItem('elevare_scheduled_posts', JSON.stringify(scheduledPosts));

            showNotification(`üìÖ ${type} agendada para ${post.scheduledForDisplay}`, 'success');
            updateScheduledPostsDisplay();
            
            // Limpar campos
            if (type === 'Story') {
                document.getElementById('story-text').value = '';
                updateStoryPreview();
            } else if (type === 'Carrossel') {
                document.getElementById('carrossel-description').value = '';
                updateCarrosselPreview();
            } else {
                document.getElementById('feed-text').value = '';
                updateFeedPreview();
            }
        }

        function getContentData(type) {
            if (type === 'Story') {
                return {
                    text: document.getElementById('story-text').value,
                    cta: document.getElementById('story-cta').value,
                    color: document.getElementById('story-color').value
                };
            } else if (type === 'Carrossel') {
                return {
                    title: document.getElementById('carrossel-title').value,
                    description: document.getElementById('carrossel-description').value
                };
            } else {
                return {
                    title: document.getElementById('feed-title').value,
                    text: document.getElementById('feed-text').value
                };
            }
        }

        function closePublishModal() {
            document.getElementById('publish-modal').classList.remove('show');
            currentPublishOption = null;
        }

        function formatScheduleTime(date, time) {
            const d = new Date(`${date}T${time}`);
            return d.toLocaleString('pt-BR', { 
                day: '2-digit', 
                month: '2-digit', 
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function updateScheduledPostsDisplay() {
            const panel = document.getElementById('scheduled-posts-panel');
            if (!panel) return;

            if (scheduledPosts.length === 0) {
                panel.innerHTML = '<p style="color: #999; text-align: center;">Nenhuma postagem agendada</p>';
                return;
            }

            const html = `
                <h3>üìÖ Postagens Agendadas (${scheduledPosts.length})</h3>
                <div class="scheduled-list">
                    ${scheduledPosts.map(post => `
                        <div class="scheduled-item">
                            <div class="scheduled-item-info">
                                <div class="scheduled-item-type">
                                    ${post.type === 'Story' ? 'üì±' : post.type === 'Carrossel' ? 'üé†' : 'üì∏'}
                                    ${post.type}
                                </div>
                                <div class="scheduled-item-time">
                                    üïê ${post.scheduledForDisplay}
                                </div>
                                <div style="font-size: 0.85rem; color: #666; margin-top: 5px;">
                                    ${post.data.text?.substring(0, 40) || post.data.title?.substring(0, 40)}...
                                </div>
                            </div>
                            <div class="scheduled-item-actions">
                                <button class="btn-small btn-edit" onclick="editScheduledPost(${post.id})">‚úèÔ∏è Editar</button>
                                <button class="btn-small btn-delete" onclick="deleteScheduledPost(${post.id})">üóëÔ∏è Deletar</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            panel.innerHTML = html;
        }

        function deleteScheduledPost(id) {
            if (confirm('Tem certeza que quer deletar esta postagem agendada?')) {
                scheduledPosts = scheduledPosts.filter(p => p.id !== id);
                localStorage.setItem('elevare_scheduled_posts', JSON.stringify(scheduledPosts));
                updateScheduledPostsDisplay();
                showNotification('‚úÖ Postagem agendada removida', 'success');
            }
        }

        function editScheduledPost(id) {
            const post = scheduledPosts.find(p => p.id === id);
            if (!post) return;

            const type = post.type;
            if (type === 'Story') {
                document.getElementById('story-text').value = post.data.text;
                document.getElementById('story-cta').value = post.data.cta || 'Saiba mais';
                document.getElementById('story-color').value = post.data.color || '#000000';
                updateStoryPreview();
            } else if (type === 'Carrossel') {
                document.getElementById('carrossel-title').value = post.data.title;
                document.getElementById('carrossel-description').value = post.data.description;
                updateCarrosselPreview();
            } else {
                document.getElementById('feed-title').value = post.data.title;
                document.getElementById('feed-text').value = post.data.text;
                updateFeedPreview();
            }

            deleteScheduledPost(id);
            showNotification('‚úèÔ∏è Postagem carregada. Fa√ßa suas edi√ß√µes e reagende.', 'info');
        }

        // ===== AUTO-PUBLISH SCHEDULED POSTS =====
        function checkAndPublishScheduledPosts() {
            const now = new Date();
            const postsToPublish = scheduledPosts.filter(post => {
                if (post.status !== 'scheduled') return false;
                const scheduledTime = new Date(post.scheduledFor);
                return scheduledTime <= now;
            });

            postsToPublish.forEach(post => {
                publishScheduledPost(post);
            });
        }

        function publishScheduledPost(post) {
            post.status = 'published';
            post.publishedAt = new Date().toLocaleString('pt-BR');
            localStorage.setItem('elevare_scheduled_posts', JSON.stringify(scheduledPosts));
            updateScheduledPostsDisplay();
            showNotification(`‚úÖ ${post.type} agendada foi publicada automaticamente!`, 'success');
        }

        // Verificar postagens agendadas a cada minuto
        setInterval(checkAndPublishScheduledPosts, 60000);
        
        // Inicializar painel de postagens agendadas
        updateScheduledPostsDisplay();
        
        // Inicializar painel de c√≥pias
        updateCopiesDisplay();
        
        // ===== QUICK MODE - MODO R√ÅPIDO =====
        let quickModeData = {
            objetivo: null,
            tema: null,
            procedimento: null,
            currentStep: 1
        };

        const neurosalesTexts = {
            converter: {
                gatilhos: [
                    "Resultado GARANTIDO ou seu dinheiro de volta",
                    "√öltimas 3 vagas do m√™s!",
                    "Promo√ß√£o EXCLUSIVA acaba em 48h",
                    "Pacote VIP com 40% OFF hoje",
                    "Seja a pr√≥xima transforma√ß√£o!",
                    "Agende AGORA e ganhe b√¥nus surpresa"
                ],
                ctas: [
                    "Clique no link da bio AGORA!",
                    "Mande DM com a palavra QUERO",
                    "Link na bio - Vagas limitadas!",
                    "Garanta sua vaga: Link na bio",
                    "N√£o perca! Chama no direct",
                    "√öltimas vagas! Link acima ‚¨ÜÔ∏è"
                ]
            },
            educar: {
                gatilhos: [
                    "Voc√™ sabia que 80% das pessoas n√£o sabem disso?",
                    "O segredo que ningu√©m te conta",
                    "A verdade sobre [procedimento]",
                    "3 mitos que voc√™ precisa parar de acreditar",
                    "Como funciona na pr√°tica",
                    "O que os profissionais fazem"
                ],
                ctas: [
                    "Salva esse post para consultar depois!",
                    "Compartilhe com quem precisa saber",
                    "Comenta AI se voc√™ sabia!",
                    "Marca aquela amiga que precisa ver",
                    "Pergunta qualquer d√∫vida nos coment√°rios",
                    "Me segue para mais conte√∫do assim"
                ]
            },
            engajar: {
                gatilhos: [
                    "Comenta qual √© o seu maior sonho!",
                    "Voc√™ prefere A ou B? Vote!",
                    "Tag aquela amiga que ia amar isso",
                    "Qual procedimento voc√™ quer ver aqui?",
                    "Quem mais se identifica? üôã‚Äç‚ôÄÔ∏è",
                    "Conta pra gente sua experi√™ncia!"
                ],
                ctas: [
                    "Responde aqui embaixo! ‚¨áÔ∏è",
                    "Bora interagir? Comenta a√≠!",
                    "Marca algu√©m nos coment√°rios",
                    "Vota nas rea√ß√µes do story!",
                    "Me manda um direct com sua opini√£o",
                    "Compartilha nos seus stories!"
                ]
            }
        };

        const visualThemes = {
            elegante: {
                name: 'Elegante',
                primaryColor: '#1e3a8a',
                secondaryColor: '#6366f1',
                textColor: '#ffffff',
                fontFamily: 'Georgia, serif',
                fontSize: '2.5rem',
                gradient: 'linear-gradient(135deg, #1e3a8a, #6366f1)'
            },
            bold: {
                name: 'Bold',
                primaryColor: '#dc2626',
                secondaryColor: '#f97316',
                textColor: '#ffffff',
                fontFamily: 'Impact, sans-serif',
                fontSize: '3rem',
                gradient: 'linear-gradient(135deg, #dc2626, #f97316)'
            },
            clean: {
                name: 'Clean',
                primaryColor: '#f5f5f5',
                secondaryColor: '#d4d4d8',
                textColor: '#1f2937',
                fontFamily: 'Helvetica, Arial, sans-serif',
                fontSize: '2.2rem',
                gradient: 'linear-gradient(135deg, #f5f5f5, #d4d4d8)'
            },
            luxury: {
                name: 'Luxury',
                primaryColor: '#78350f',
                secondaryColor: '#fbbf24',
                textColor: '#ffffff',
                fontFamily: 'Playfair Display, serif',
                fontSize: '2.8rem',
                gradient: 'linear-gradient(135deg, #78350f, #fbbf24)'
            },
            fresh: {
                name: 'Fresh',
                primaryColor: '#10b981',
                secondaryColor: '#6ee7b7',
                textColor: '#ffffff',
                fontFamily: 'Montserrat, sans-serif',
                fontSize: '2.5rem',
                gradient: 'linear-gradient(135deg, #10b981, #6ee7b7)'
            },
            warm: {
                name: 'Warm',
                primaryColor: '#f59e0b',
                secondaryColor: '#fbbf24',
                textColor: '#ffffff',
                fontFamily: 'Raleway, sans-serif',
                fontSize: '2.6rem',
                gradient: 'linear-gradient(135deg, #f59e0b, #fbbf24)'
            }
        };

        function openQuickMode() {
            document.getElementById('quick-mode-modal').classList.add('show');
            quickModeData = { objetivo: null, tema: null, procedimento: null, currentStep: 1 };
            updateQuickModeSteps();
        }

        function selectQuickOption(type, value, element) {
            // Remove selected class from siblings
            const siblings = element.parentElement.querySelectorAll('.quick-option');
            siblings.forEach(s => s.classList.remove('selected'));
            
            // Add selected class
            element.classList.add('selected');
            
            // Store selection
            quickModeData[type] = value;
            
            // Enable next button
            document.getElementById('quick-next-btn').disabled = false;
        }

        function quickModeNext() {
            const currentStep = quickModeData.currentStep;
            
            if (currentStep === 1 && quickModeData.objetivo) {
                quickModeData.currentStep = 2;
                updateQuickModeSteps();
            } else if (currentStep === 2 && quickModeData.tema) {
                quickModeData.currentStep = 3;
                updateQuickModeSteps();
            } else if (currentStep === 3) {
                const procedure = document.getElementById('quick-procedure').value.trim();
                if (procedure) {
                    quickModeData.procedimento = procedure;
                    generateQuickSequence();
                } else {
                    showNotification('‚ö†Ô∏è Por favor, digite o nome do procedimento');
                }
            }
        }

        function quickModeBack() {
            if (quickModeData.currentStep > 1) {
                quickModeData.currentStep--;
                updateQuickModeSteps();
            }
        }

        function updateQuickModeSteps() {
            const step = quickModeData.currentStep;
            
            // Update step indicators
            for (let i = 1; i <= 3; i++) {
                const stepEl = document.getElementById(`step-${i}`);
                stepEl.classList.remove('active', 'completed');
                
                if (i < step) {
                    stepEl.classList.add('completed');
                } else if (i === step) {
                    stepEl.classList.add('active');
                }
            }
            
            // Update sections
            for (let i = 1; i <= 3; i++) {
                const sectionEl = document.getElementById(`quick-step-${i}`);
                if (i === step) {
                    sectionEl.classList.add('active');
                } else {
                    sectionEl.classList.remove('active');
                }
            }
            
            // Update buttons
            const backBtn = document.querySelector('.quick-btn-back');
            const nextBtn = document.getElementById('quick-next-btn');
            
            backBtn.style.display = step > 1 ? 'block' : 'none';
            
            if (step === 3) {
                nextBtn.textContent = '‚ú® Gerar Sequ√™ncia';
                nextBtn.disabled = false;
                
                // Enable button on input
                document.getElementById('quick-procedure').addEventListener('input', (e) => {
                    nextBtn.disabled = e.target.value.trim() === '';
                });
            } else {
                nextBtn.textContent = 'Pr√≥ximo ‚Üí';
                nextBtn.disabled = true;
            }
        }

        function generateQuickSequence() {
            const { objetivo, tema, procedimento } = quickModeData;
            const theme = visualThemes[tema];
            const texts = neurosalesTexts[objetivo];
            const generateAll = document.getElementById('quick-generate-all')?.checked;
            
            showNotification('‚ö° Gerando sequ√™ncia completa...');
            
            // Close modal
            document.getElementById('quick-mode-modal').classList.remove('show');
            
            if (generateAll) {
                generateAllFormats(theme, texts, procedimento, objetivo);
                return;
            }

            // Switch to Story tab
            switchTab('story');
            
            // Generate 1 story principal
            setTimeout(() => {
                const mainText = applyBrandPlaceholders(texts.gatilhos[0] || procedimento || 'Seu texto aqui');
                document.getElementById('story-text').value = mainText;
                document.getElementById('story-background-color').value = theme.primaryColor;
                document.getElementById('story-text-color').value = theme.textColor;
                
                // Apply theme
                const storyContent = document.getElementById('story-preview-content');
                const storyTextEl = document.getElementById('preview-story-text');
                storyContent.style.background = theme.gradient;
                storyTextEl.textContent = mainText;
                storyTextEl.style.color = theme.textColor;
                storyTextEl.style.fontFamily = theme.fontFamily;
                storyTextEl.style.fontSize = theme.fontSize;
                
                showNotification(`‚úÖ Story criado com tema ${theme.name}! Objetivo: ${objetivo}`);

                // Atualiza visibilidade do bot√£o de temas
                updateThemeToggleVisibility();
            }, 400);
        }

        function generateAllFormats(theme, texts, procedimento, objetivo) {
            // STORY
            const storyText = applyBrandPlaceholders(texts.gatilhos[0] || procedimento || 'Seu texto aqui');
            switchTab('story');
            document.getElementById('story-text').value = storyText;
            document.getElementById('story-background-color').value = theme.primaryColor;
            document.getElementById('story-text-color').value = theme.textColor;
            const storyContent = document.getElementById('story-preview-content');
            const storyTextEl = document.getElementById('preview-story-text');
            storyContent.style.background = theme.gradient;
            storyTextEl.textContent = storyText;
            storyTextEl.style.color = theme.textColor;
            storyTextEl.style.fontFamily = theme.fontFamily;
            storyTextEl.style.fontSize = theme.fontSize;

            // CARROSSEL
            const slideTitle = applyBrandPlaceholders(`3 motivos para ${procedimento}`);
            const slideDesc = applyBrandPlaceholders(texts.gatilhos[1] || 'Benef√≠cios claros e objetivos');
            document.getElementById('carrossel-title').value = slideTitle;
            document.getElementById('carrossel-description').value = slideDesc;
            document.getElementById('carrossel-procedure').value = procedimento;
            document.getElementById('carrossel-type').value = 'beneficios';
            document.getElementById('carrossel-slides').value = '5';
            const carrosselContent = document.getElementById('carrossel-preview-content');
            const slideTitleEl = document.getElementById('preview-slide-title');
            const slideTextEl = document.getElementById('preview-slide-text');
            carrosselContent.style.background = theme.gradient;
            slideTitleEl.textContent = slideTitle;
            slideTextEl.textContent = slideDesc;
            slideTitleEl.style.color = theme.textColor;
            slideTextEl.style.color = theme.textColor;
            slideTitleEl.style.fontFamily = theme.fontFamily;
            slideTextEl.style.fontFamily = theme.fontFamily;

            // FEED
            const feedTitle = applyBrandPlaceholders(`${procedimento}: o que voc√™ precisa saber`);
            const feedText = applyBrandPlaceholders(`${texts.gatilhos[2] || 'Veja como funciona e quem √© ideal.'}\n\nCTA: Fale no WhatsApp ${brandProfile?.phone || ''}`);
            document.getElementById('feed-title').value = feedTitle;
            document.getElementById('feed-text').value = feedText;
            const feedContent = document.getElementById('feed-preview-content');
            feedContent.style.background = theme.gradient;

            showNotification('‚úÖ Story + Carrossel + Feed gerados com o tema selecionado!', 'success');
            updateThemeToggleVisibility();
        }

        // Theme Selector logic
        function toggleThemeSelector() {
            const panel = document.getElementById('theme-selector');
            if (!panel) return;
            const isShown = panel.classList.contains('show');
            if (isShown) {
                panel.classList.remove('show');
            } else {
                panel.classList.add('show');
            }
        }

        function applyTheme(themeKey) {
            const theme = visualThemes[themeKey];
            if (!theme) return;

            // Apply to Story
            const storyContent = document.getElementById('story-preview-content');
            const storyTextEl = document.getElementById('preview-story-text');
            if (storyContent) storyContent.style.background = theme.gradient;
            if (storyTextEl) {
                storyTextEl.style.color = theme.textColor;
                storyTextEl.style.fontFamily = theme.fontFamily;
                storyTextEl.style.fontSize = theme.fontSize;
            }

            // Apply to Carrossel
            const carrosselContent = document.getElementById('carrossel-preview-content');
            const slideTitleEl = document.getElementById('preview-slide-title');
            const slideTextEl = document.getElementById('preview-slide-text');
            if (carrosselContent) carrosselContent.style.background = theme.gradient;
            if (slideTitleEl) {
                slideTitleEl.style.color = theme.textColor;
                slideTitleEl.style.fontFamily = theme.fontFamily;
            }
            if (slideTextEl) {
                slideTextEl.style.color = theme.textColor;
                slideTextEl.style.fontFamily = theme.fontFamily;
            }

            // Apply to Feed
            const feedContent = document.getElementById('feed-preview-content');
            if (feedContent) feedContent.style.background = theme.gradient;

            showNotification(`üé® Tema aplicado: ${theme.name}`);
        }

        // Close Quick Mode
        document.getElementById('quick-mode-modal').addEventListener('click', (e) => {
            if (e.target.id === 'quick-mode-modal') {
                document.getElementById('quick-mode-modal').classList.remove('show');
            }
        });

                const PIXABAY_KEY = 'YOUR_PIXABAY_KEY';

                // ===== TEMA: Visibilidade do bot√£o baseado em conte√∫do =====
                function updateThemeToggleVisibility() {
                        const themeToggleBtn = document.getElementById('theme-toggle-btn');
                        if (!themeToggleBtn) return;
                        const hasStory = (document.getElementById('story-text')?.value || '').trim().length > 0 ||
                                                         (document.getElementById('story-procedure')?.value || '').trim().length > 0;
                        const hasCarrossel = (document.getElementById('carrossel-description')?.value || '').trim().length > 0 ||
                                                                 (document.getElementById('carrossel-title')?.value || '').trim().length > 0 ||
                                                                 (document.getElementById('carrossel-procedure')?.value || '').trim().length > 0;
                        const hasFeed = (document.getElementById('feed-text')?.value || '').trim().length > 0 ||
                                                        (document.getElementById('feed-title')?.value || '').trim().length > 0;
                        const show = hasStory || hasCarrossel || hasFeed;
                        themeToggleBtn.style.display = show ? 'inline-block' : 'none';
                        if (!show) {
                                const panel = document.getElementById('theme-selector');
                                if (panel) panel.classList.remove('show');
                        }
                }

                // Eventos para atualizar visibilidade
                ['story-text','story-procedure','carrossel-description','carrossel-title','carrossel-procedure','feed-text','feed-title']
                    .forEach(id => {
                        const el = document.getElementById(id);
                        if (el) el.addEventListener('input', updateThemeToggleVisibility);
                    });

                // Primeira avalia√ß√£o
                updateThemeToggleVisibility();

        // ===== DUPLICAR SEQU√äNCIA COMPLETA =====
        function getCurrentTypeTitle() {
            if (typeof currentTab === 'string') {
                if (currentTab === 'story') return 'Story';
                if (currentTab === 'carrossel') return 'Carrossel';
                if (currentTab === 'feed') return 'Feed';
            }
            // Fallback: detect by visible form
            if (document.getElementById('story-form').style.display === 'block') return 'Story';
            if (document.getElementById('carrossel-form').style.display === 'block') return 'Carrossel';
            if (document.getElementById('feed-form').style.display === 'block') return 'Feed';
            return 'Story';
        }

        function collectDataForType(typeTitle) {
            if (typeTitle === 'Story') {
                return {
                    procedure: document.getElementById('story-procedure')?.value || '',
                    text: document.getElementById('story-text')?.value || '',
                    bg: document.getElementById('story-background-color')?.value || '',
                    color: document.getElementById('story-text-color')?.value || ''
                };
            } else if (typeTitle === 'Carrossel') {
                return {
                    title: document.getElementById('carrossel-title')?.value || '',
                    type: document.getElementById('carrossel-type')?.value || '',
                    slides: document.getElementById('carrossel-slides')?.value || '5',
                    procedure: document.getElementById('carrossel-procedure')?.value || '',
                    description: document.getElementById('carrossel-description')?.value || ''
                };
            } else {
                return {
                    title: document.getElementById('feed-title')?.value || '',
                    text: document.getElementById('feed-text')?.value || ''
                };
            }
        }

        function duplicateCurrentSequence() {
            const typeTitle = getCurrentTypeTitle();
            const data = collectDataForType(typeTitle);
            const allCopies = JSON.parse(localStorage.getItem('elevare_copies') || '[]');
            const countForType = allCopies.filter(c => c.type === typeTitle).length + 1;
            const copy = {
                id: Date.now(),
                type: typeTitle,
                name: `C√≥pia ${countForType} - ${typeTitle}`,
                createdAt: new Date().toISOString(),
                data
            };
            allCopies.push(copy);
            localStorage.setItem('elevare_copies', JSON.stringify(allCopies));
            updateCopiesDisplay();
            showNotification(`‚úÖ ${copy.name} criada!`, 'success');
        }

        function updateCopiesDisplay() {
            const container = document.getElementById('copies-panel');
            if (!container) return;
            const copies = JSON.parse(localStorage.getItem('elevare_copies') || '[]');
            if (copies.length === 0) {
                container.innerHTML = '<div style="color:#666">Nenhuma c√≥pia criada ainda.</div>';
                return;
            }
            container.innerHTML = copies.map(c => `
                <div class="scheduled-item">
                    <div class="item-main">
                        <div class="item-title">${c.name}</div>
                        <div class="item-sub">${new Date(c.createdAt).toLocaleString('pt-BR')} ‚Ä¢ ${c.type}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn-small btn-edit" onclick="loadCopy(${c.id})">Carregar</button>
                        <button class="btn-small btn-delete" onclick="deleteCopy(${c.id})">Excluir</button>
                    </div>
                </div>
            `).join('');
        }

        function loadCopy(id) {
            const copies = JSON.parse(localStorage.getItem('elevare_copies') || '[]');
            const c = copies.find(x => x.id === id);
            if (!c) return;
            // Switch tab to the copy type
            const tabKey = c.type === 'Story' ? 'story' : (c.type === 'Carrossel' ? 'carrossel' : 'feed');
            switchTab(tabKey);
            // Apply data to fields
            if (c.type === 'Story') {
                document.getElementById('story-procedure').value = c.data.procedure;
                document.getElementById('story-text').value = c.data.text;
                if (c.data.bg) document.getElementById('story-preview-content').style.background = c.data.bg;
                if (c.data.color) document.getElementById('preview-story-text').style.color = c.data.color;
                updateStoryPreview();
            } else if (c.type === 'Carrossel') {
                document.getElementById('carrossel-title').value = c.data.title;
                document.getElementById('carrossel-type').value = c.data.type;
                document.getElementById('carrossel-slides').value = c.data.slides;
                document.getElementById('carrossel-procedure').value = c.data.procedure;
                document.getElementById('carrossel-description').value = c.data.description;
                updateCarrosselPreview();
            } else {
                document.getElementById('feed-title').value = c.data.title;
                document.getElementById('feed-text').value = c.data.text;
                updateFeedPreview();
            }
            showNotification(`üì¶ ${c.name} carregada`, 'success');
        }

        function deleteCopy(id) {
            const copies = JSON.parse(localStorage.getItem('elevare_copies') || '[]');
            const next = copies.filter(x => x.id !== id);
            localStorage.setItem('elevare_copies', JSON.stringify(next));
            updateCopiesDisplay();
            showNotification('üóëÔ∏è C√≥pia removida', 'success');
        }

        // Termos de busca inteligentes para est√©tica
        const quickSearchTerms = [
            'harmoniza√ß√£o facial', 'botox', 'preenchimento labial',
            'skincare', 'limpeza de pele', 'massagem facial',
            'spa tratamento', 'beleza natural', 'rejuvenescimento',
            'est√©tica profissional', 'cuidados com a pele', 'antes e depois'
        ];

        // Sequ√™ncias de neurovendas com intelig√™ncia de vendas
        const storySequences = {
            atrair: {
                name: 'üéØ Atrair',
                icon: 'üéØ',
                description: 'Capturar aten√ß√£o e quebrar padr√µes',
                stories: [
                    { text: 'Voc√™ acha que precisa de 10k seguidores pra vender bem? Se acredita nisso, continue acreditando. Os outros v√£o ficar com a grana.', trigger: 'Quebra de Padr√£o', psicologia: 'Contraste' },
                    { text: 'Toda semana algu√©m me pergunta: "Como voc√™ enche agenda?". Ningu√©m quer saber como eu gasto com an√∫ncio. Eles querem saber O SEGREDO.', trigger: 'Curiosidade', psicologia: 'Abertura' },
                    { text: 'Enquanto voc√™ posta esperando "engajamento", profissionais com menos seguidores est√£o lotando agenda. Quer saber a diferen√ßa?', trigger: 'Contraste', psicologia: 'FOMO' },
                    { text: 'Existe um m√©todo que a maioria das esteticistas n√£o sabe. Um padr√£o escondido nos stories das melhores profissionais. Vou te mostrar nos pr√≥ximos.', trigger: 'Mist√©rio', psicologia: 'Intriga' },
                ]
            },
            aquecer: {
                name: 'üî• Aquecer',
                icon: 'üî•',
                description: 'Construir relacionamento e confian√ßa',
                stories: [
                    { text: 'Sabe aquela cliente que "pensa e volta"? Ela n√£o est√° em d√∫vida sobre o procedimento. Ela est√° em d√∫vida sobre VOC√ä.', trigger: 'Revela√ß√£o', psicologia: 'Insight' },
                    { text: 'O que eu aprendi: confian√ßa vem ANTES do procedimento, n√£o depois. Todo story que voc√™ faz √© pra construir confian√ßa (ou destruir).', trigger: 'Educa√ß√£o', psicologia: 'Aprendizado' },
                    { text: 'Minha melhor cliente n√£o sabia nada de harmoniza√ß√£o. Mas sabia de MIM. Ela tinha confian√ßa em mim. √â por isso que ela comprou.', trigger: 'Exemplo', psicologia: 'Valida√ß√£o' },
                ]
            },
            converter: {
                name: 'üí∞ Converter',
                icon: 'üí∞',
                description: 'Gerar vendas imediatas',
                stories: [
                    { text: 'Harmoniza√ß√£o Facial: O procedimento que custa menos que um bom corte de cabelo e muda a vida. Temos vagas essa semana. Clica aqui.', trigger: 'CTA Direto', psicologia: 'Urg√™ncia' },
                    { text: 'Promo√ß√£o especial: Harmoniza√ß√£o + Botox por apenas R$ 999. Vagas limitadas. Responde aqui mesmo que mando o agendamento.', trigger: 'Oferta', psicologia: 'Escassez' },
                    { text: '√öltima chance: Sua consulta diagn√≥stica GR√ÅTIS termina hoje. Clique no link da bio e agende seu hor√°rio.', trigger: 'Escassez', psicologia: 'FOMO' },
                ]
            },
            educar: {
                name: 'üìö Educar',
                icon: 'üìö',
                description: 'Ensinar e estabelecer autoridade',
                stories: [
                    { text: 'Mito: Harmoniza√ß√£o deixa o rosto "preso". Verdade: Harmoniza√ß√£o bem feita √© IMPERCEPT√çVEL. O segredo est√° na propor√ß√£o (n√£o na quantidade).', trigger: 'Educa√ß√£o', psicologia: 'Esclarecimento' },
                    { text: '5 sinais que voc√™ est√° com o √°cido hialur√¥nico vencido: 1. Incha√ßo prolongado 2. Resultado assim√©trico 3. N√≥dulos 4. Rea√ß√£o al√©rgica 5. Resultados fracos', trigger: 'Lista', psicologia: 'Valor' },
                    { text: 'Escolha certa: M√©dico certificado > Curso r√°pido. Equipamento adequado > Equipamento barato. Estudo constante > Achismo. Seus resultados dependem disso.', trigger: 'Autoridade', psicologia: 'Credibilidade' },
                ]
            },
            reposicionar: {
                name: '‚ö° Reposicionar',
                icon: '‚ö°',
                description: 'Redefinir a marca e autoridade',
                stories: [
                    { text: 'Eu n√£o vendo procedimentos. Vendo TRANSFORMA√á√ÉO. A diferen√ßa √© tudo. Quem entender isso, consegue marcar.', trigger: 'Posicionamento', psicologia: 'Diferencia√ß√£o' },
                    { text: 'Enquanto outros competem por pre√ßo, eu compito por confian√ßa. Qual voc√™ acha que vence?', trigger: 'Contraste', psicologia: 'Posicionamento' },
                ]
            },
            reativar: {
                name: 'üîÑ Reativar',
                icon: 'üîÑ',
                description: 'Reconectar com p√∫blico antigo',
                stories: [
                    { text: 'Faz tempo que voc√™ n√£o v√™ meus stories. Muita coisa mudou. Tenho novos procedimentos, nova cl√≠nica, e preciso te contar sobre tudo.', trigger: 'Reconex√£o', psicologia: 'Nostalgia' },
                    { text: 'Suas antigas clientes est√£o sendo atendidas por concorrentes? Chegou a hora de voltar. Te esperamos.', trigger: 'Reaproxima√ß√£o', psicologia: 'Pertencimento' },
                ]
            }
        };

        // Global state
        let currentTab = 'story';
        let stats = { stories: 0, carrosseis: 0, feeds: 0 };
        let currentContent = {
            story: { background: '#F5F5F5', color: '#667eea', font: 'Inter', fontSize: 24, textAlign: 'center' },
            carrossel: { color: '#667eea', slides: 5, layout: 'educativo' },
            feed: { objective: 'vender', emotion: 'confianca' }
        };
        let generatedStories = {};

        // Tab switching
        function switchTab(tab) {
            currentTab = tab;
            
            // Hide all forms and previews
            document.getElementById('story-form').style.display = 'none';
            document.getElementById('carrossel-form').style.display = 'none';
            document.getElementById('feed-form').style.display = 'none';
            document.getElementById('story-preview').style.display = 'none';
            document.getElementById('carrossel-preview').style.display = 'none';
            document.getElementById('feed-preview').style.display = 'none';
            
            // Show selected
            document.getElementById(`${tab}-form`).style.display = 'block';
            document.getElementById(`${tab}-preview`).style.display = 'flex';
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update previews
            if (tab === 'story') updateStoryPreview();
            else if (tab === 'carrossel') updateCarrosselPreview();
            else if (tab === 'feed') updateFeedPreview();

            // Atualiza visibilidade do bot√£o de temas ao trocar de aba
            updateThemeToggleVisibility();
        }

        // Color selection
        function selectColor(type, color) {
            if (type === 'story') {
                document.getElementById('story-preview-content').style.background = color;
                currentContent.story.background = color;
            } else if (type === 'carrossel') {
                currentContent.carrossel.color = color;
                updateCarrosselPreview();
            }
        }

        // Update Story Preview
        function updateStoryPreview() {
            const text = document.getElementById('story-text').value || 'Seu texto aqui';
            const cta = document.getElementById('story-cta').value || 'Saiba mais';
            const positionY = document.getElementById('story-position-y').value || 50;
            
            document.getElementById('preview-story-text').textContent = text;
            document.getElementById('preview-story-cta').textContent = cta;
            
            // Update vertical position
            const textElement = document.getElementById('preview-story-text');
            textElement.style.top = positionY + '%';
            textElement.style.transform = 'translateY(-50%)';
            
            // Update position label
            let positionLabel = 'Centro';
            if (positionY < 35) positionLabel = 'Topo';
            else if (positionY > 65) positionLabel = 'Rodap√©';
            document.getElementById('position-y-label').textContent = positionLabel;
            
            // Update position buttons
            updatePositionButtons();
            
            // Enable auto-save
            enableAutoSave();
            saveToHistory();
        }

        // Update Carrossel Preview
        function updateCarrosselPreview() {
            const slides = parseInt(document.getElementById('carrossel-slides').value) || 5;
            const currentSlide = 1;
            document.getElementById('current-slide').textContent = currentSlide;
            document.getElementById('total-slides').textContent = slides;
            document.getElementById('progress-fill').style.width = `${(currentSlide / slides) * 100}%`;
            document.getElementById('preview-slide-title').textContent = document.getElementById('carrossel-title').value || 'T√≠tulo do Slide';
            document.getElementById('preview-slide-text').textContent = document.getElementById('carrossel-description').value || 'Conte√∫do do slide...';
        }

        // Update Feed Preview
        function updateFeedPreview() {
            const caption = document.getElementById('feed-caption').value || 'Sua legenda aqui...';
            document.getElementById('preview-feed-caption').textContent = caption;
        }

        // Event listeners for real-time preview update
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializar toggle de sync
            if (syncStylesEnabled) {
                document.getElementById('sync-toggle').classList.add('on');
            }

            document.getElementById('story-text').addEventListener('input', (e) => {
                updateStoryPreview();
                updateValidation('Story', 'story-text');
            });
            document.getElementById('story-cta').addEventListener('input', updateStoryPreview);
            document.getElementById('story-font').addEventListener('change', (e) => {
                updateStoryPreview();
                syncStylesAcrossTab('font', e.target.value);
            });
            document.getElementById('story-size').addEventListener('input', (e) => {
                updateStoryPreview();
                syncStylesAcrossTab('size', e.target.value);
            });
            document.getElementById('carrossel-title').addEventListener('input', (e) => {
                updateCarrosselPreview();
                updateValidation('Carrossel', 'carrossel-title');
            });
            document.getElementById('carrossel-description').addEventListener('input', (e) => {
                updateCarrosselPreview();
                updateValidation('Carrossel', 'carrossel-description');
            });
            document.getElementById('carrossel-slides').addEventListener('change', updateCarrosselPreview);
            document.getElementById('feed-caption').addEventListener('input', (e) => {
                updateFeedPreview();
                updateValidation('Feed', 'feed-caption');
            });

            // Add event listeners for color sync
            document.getElementById('story-color').addEventListener('change', (e) => {
                syncStylesAcrossTab('color', e.target.value);
            });
        });

        // ===== AUTO-SAVE SYSTEM =====
        let autoSaveTimer = null;
        let lastSaveTime = Date.now();
        let syncStylesEnabled = JSON.parse(localStorage.getItem('elevare_sync_enabled')) || false;
        let historyFilter = 'all';

        function enableAutoSave() {
            clearTimeout(autoSaveTimer);
            autoSaveTimer = setTimeout(() => {
                const activeTab = document.querySelector('.tab.active')?.textContent.trim();
                if (activeTab === 'Story') autoSaveStory();
                else if (activeTab === 'Carrossel') autoSaveCarrossel();
                else if (activeTab === 'Feed') autoSaveFeed();
                lastSaveTime = Date.now();
            }, 2000);
        }

        async function autoSaveStory() {
            const data = {
                text: document.getElementById('story-text').value,
                cta: document.getElementById('story-cta').value,
                font: document.getElementById('story-font').value,
                size: document.getElementById('story-size').value,
                color: document.getElementById('story-color').value,
                positionY: document.getElementById('story-position-y').value,
                timestamp: Date.now()
            };
            localStorage.setItem('elevare_story_autosave', JSON.stringify(data));
            addToHistory('Story', data);
        }

        async function autoSaveCarrossel() {
            const data = {
                title: document.getElementById('carrossel-title').value,
                description: document.getElementById('carrossel-description').value,
                slides: document.getElementById('carrossel-slides').value,
                timestamp: Date.now()
            };
            localStorage.setItem('elevare_carrossel_autosave', JSON.stringify(data));
            addToHistory('Carrossel', data);
        }

        async function autoSaveFeed() {
            const data = {
                title: document.getElementById('feed-title').value,
                text: document.getElementById('feed-text').value,
                timestamp: Date.now()
            };
            localStorage.setItem('elevare_feed_autosave', JSON.stringify(data));
            addToHistory('Feed', data);
        }

        // ===== EDIT HISTORY TRACKING =====
        let editHistory = JSON.parse(localStorage.getItem('elevare_edit_history')) || [];
        const MAX_HISTORY_ITEMS = 20;

        function addToHistory(type, data) {
            const entry = {
                type,
                timestamp: Date.now(),
                data: { ...data },
                summary: generateSummary(type, data)
            };
            editHistory.unshift(entry);
            if (editHistory.length > MAX_HISTORY_ITEMS) editHistory.pop();
            localStorage.setItem('elevare_edit_history', JSON.stringify(editHistory));
            updateHistoryDisplay();
        }

        function generateSummary(type, data) {
            if (type === 'Story') {
                return `Texto: "${data.text.substring(0, 30)}..." | Cor: ${data.color}`;
            } else if (type === 'Carrossel') {
                return `T√≠tulo: "${data.title.substring(0, 20)}..." | Slides: ${data.slides}`;
            } else {
                return `Feed: "${data.text.substring(0, 30)}..."`;
            }
        }

        function updateHistoryDisplay() {
            const historyPanel = document.getElementById('history-panel');
            if (!historyPanel) return;

            const filtered = historyFilter === 'all' 
                ? editHistory 
                : editHistory.filter(item => item.type === historyFilter);

            if (filtered.length === 0) {
                historyPanel.innerHTML = '<p style="color: #999; text-align: center;">Nenhuma edi√ß√£o</p>';
                return;
            }

            const html = `
                <div class="history-filters">
                    <button class="filter-btn ${historyFilter === 'all' ? 'active' : ''}" onclick="setHistoryFilter('all')">Tudo</button>
                    <button class="filter-btn ${historyFilter === 'Story' ? 'active' : ''}" onclick="setHistoryFilter('Story')">üì± Story</button>
                    <button class="filter-btn ${historyFilter === 'Carrossel' ? 'active' : ''}" onclick="setHistoryFilter('Carrossel')">üé† Carrossel</button>
                    <button class="filter-btn ${historyFilter === 'Feed' ? 'active' : ''}" onclick="setHistoryFilter('Feed')">üì∏ Feed</button>
                    <button class="filter-btn" onclick="clearHistory()" style="margin-left: auto; background: #fee2e2; color: #991b1b; border-color: #ef4444;">üóëÔ∏è Limpar</button>
                </div>
                <div class="history-timeline">
                    ${filtered.map((item, i) => `
                        <div class="history-item">
                            <span class="history-time">${formatTime(item.timestamp)}</span>
                            <div class="history-change">${item.type}: ${item.summary}</div>
                            ${i < filtered.length - 1 ? `<span class="history-revert" onclick="revertToHistory(${editHistory.indexOf(item)})">‚Ü∂ Voltar</span>` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
            historyPanel.innerHTML = html;
        }

        function setHistoryFilter(filter) {
            historyFilter = filter;
            updateHistoryDisplay();
        }

        function clearHistory() {
            if (confirm('Tem certeza? Isso vai limpar todo o hist√≥rico de edi√ß√µes!')) {
                editHistory = [];
                localStorage.setItem('elevare_edit_history', JSON.stringify(editHistory));
                updateHistoryDisplay();
                showNotification('‚úÖ Hist√≥rico limpo', 'success');
            }
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            
            if (minutes < 1) return 'Agora';
            if (minutes < 60) return `${minutes}m atr√°s`;
            if (hours < 24) return `${hours}h atr√°s`;
            return date.toLocaleDateString('pt-BR');
        }

        function revertToHistory(index) {
            const item = editHistory[index];
            if (!item) return;

            const data = item.data;
            const type = item.type;

            if (type === 'Story') {
                document.getElementById('story-text').value = data.text;
                document.getElementById('story-cta').value = data.cta;
                document.getElementById('story-font').value = data.font;
                document.getElementById('story-size').value = data.size;
                document.getElementById('story-color').value = data.color;
                document.getElementById('story-position-y').value = data.positionY;
                updateStoryPreview();
            } else if (type === 'Carrossel') {
                document.getElementById('carrossel-title').value = data.title;
                document.getElementById('carrossel-description').value = data.description;
                document.getElementById('carrossel-slides').value = data.slides;
                updateCarrosselPreview();
            } else {
                document.getElementById('feed-title').value = data.title;
                document.getElementById('feed-text').value = data.text;
                updateFeedPreview();
            }

            showNotification(`‚úÖ Revertido para ${formatTime(item.timestamp)}`, 'success');
        }

        // ===== DRAFT RECOVERY =====
        function checkDraftRecovery() {
            const storyDraft = localStorage.getItem('elevare_story_autosave');
            const carrosselDraft = localStorage.getItem('elevare_carrossel_autosave');
            const feedDraft = localStorage.getItem('elevare_feed_autosave');

            if (storyDraft || carrosselDraft || feedDraft) {
                const banner = document.getElementById('draft-banner');
                if (banner) {
                    banner.classList.add('show');

                    // Mostrar info dos drafts
                    if (storyDraft) {
                        const data = JSON.parse(storyDraft);
                        document.getElementById('draft-story-item').style.display = 'block';
                        document.getElementById('draft-story-preview').textContent = data.text.substring(0, 30) + '...';
                    }
                    if (carrosselDraft) {
                        const data = JSON.parse(carrosselDraft);
                        document.getElementById('draft-carrossel-item').style.display = 'block';
                        document.getElementById('draft-carrossel-preview').textContent = data.title.substring(0, 30) + '...';
                    }
                    if (feedDraft) {
                        const data = JSON.parse(feedDraft);
                        document.getElementById('draft-feed-item').style.display = 'block';
                        document.getElementById('draft-feed-preview').textContent = data.text.substring(0, 30) + '...';
                    }

                    // Mostrar tempo
                    const timestamps = [];
                    if (storyDraft) timestamps.push(JSON.parse(storyDraft).timestamp);
                    if (carrosselDraft) timestamps.push(JSON.parse(carrosselDraft).timestamp);
                    if (feedDraft) timestamps.push(JSON.parse(feedDraft).timestamp);
                    const latestTime = Math.max(...timestamps);
                    document.getElementById('draft-time-item').textContent = `‚è∞ ${formatTime(latestTime)}`;
                }
            }
        }

        function restoreDraft() {
            const drafts = {
                story: localStorage.getItem('elevare_story_autosave'),
                carrossel: localStorage.getItem('elevare_carrossel_autosave'),
                feed: localStorage.getItem('elevare_feed_autosave')
            };

            if (drafts.story) {
                const data = JSON.parse(drafts.story);
                document.getElementById('story-text').value = data.text || '';
                document.getElementById('story-cta').value = data.cta || 'Saiba mais';
                document.getElementById('story-font').value = data.font || 'Arial';
                document.getElementById('story-size').value = data.size || 24;
                document.getElementById('story-color').value = data.color || '#000000';
                document.getElementById('story-position-y').value = data.positionY || 50;
                updateStoryPreview();
            }

            if (drafts.carrossel) {
                const data = JSON.parse(drafts.carrossel);
                document.getElementById('carrossel-title').value = data.title || '';
                document.getElementById('carrossel-description').value = data.description || '';
                document.getElementById('carrossel-slides').value = data.slides || 5;
                updateCarrosselPreview();
            }

            if (drafts.feed) {
                const data = JSON.parse(drafts.feed);
                document.getElementById('feed-title').value = data.title || '';
                document.getElementById('feed-text').value = data.text || '';
                updateFeedPreview();
            }

            document.getElementById('draft-banner').classList.remove('show');
            showNotification('‚úÖ Drafts restaurados com sucesso!', 'success');
        }

        function discardDraft() {
            localStorage.removeItem('elevare_story_autosave');
            localStorage.removeItem('elevare_carrossel_autosave');
            localStorage.removeItem('elevare_feed_autosave');
            document.getElementById('draft-banner').classList.remove('show');
            showNotification('üóëÔ∏è Drafts descartados', 'info');
        }

        // ===== CONTENT VALIDATION =====
        function validateContent(type, text) {
            const messages = [];
            const isStory = type === 'Story';

            if (!text || text.trim().length === 0) {
                messages.push({ type: 'error', text: '‚ùå Texto vazio' });
            } else if (text.length < 10) {
                messages.push({ type: 'warning', text: '‚ö†Ô∏è Muito curto (<10 caracteres)' });
            } else if (text.length > 300) {
                messages.push({ type: 'warning', text: '‚ö†Ô∏è Muito longo (>300 caracteres)' });
            } else {
                messages.push({ type: 'success', text: '‚úÖ Conte√∫do validado' });
            }

            return messages;
        }

        function getStatusBadge(text) {
            if (!text || text.length < 10) return 'error';
            if (text.length > 300) return 'warning';
            return 'ready';
        }

        function updateValidation(type, elementId) {
            const element = document.getElementById(elementId);
            const text = element.value;
            const messages = validateContent(type, text);

            let container = element.nextElementSibling;
            if (container && container.classList.contains('validation-container')) {
                container.remove();
            }

            const container2 = document.createElement('div');
            container2.className = 'validation-container';

            // Adicionar counter com contexto
            const counterEl = document.createElement('div');
            const status = getStatusBadge(text);
            counterEl.className = `char-counter ${status === 'warning' ? 'warning' : status === 'error' ? 'error' : ''}`;
            
            let contextMsg = '';
            if (text.length > 0 && text.length < 20) {
                contextMsg = ' (Muito curto para Story, OK para Feed)';
            } else if (text.length > 250) {
                contextMsg = ' (Longo, considere dividir em m√∫ltiplos posts)';
            }
            
            counterEl.innerHTML = `
                <span>${text.length}/300 caracteres${contextMsg}</span>
                <span class="status-badge ${status}">${status === 'ready' ? 'üü¢ Pronto' : status === 'warning' ? 'üü° Aviso' : 'üî¥ Erro'}</span>
            `;
            container2.appendChild(counterEl);

            messages.forEach(msg => {
                const msgEl = document.createElement('div');
                msgEl.className = `validation-msg ${msg.type}`;
                msgEl.textContent = msg.text;
                container2.appendChild(msgEl);
            });

            element.parentNode.insertBefore(container2, element.nextSibling);
        }

        // ===== SYNC STYLES ACROSS TABS =====
        function toggleStyleSync() {
            syncStylesEnabled = !syncStylesEnabled;
            localStorage.setItem('elevare_sync_enabled', syncStylesEnabled);
            document.getElementById('sync-toggle').classList.toggle('on', syncStylesEnabled);
            showNotification(syncStylesEnabled ? 'üîÑ Sync ativado' : 'üîÑ Sync desativado', 'info');
        }

        function syncStylesAcrossTab(style, value) {
            if (!syncStylesEnabled) return;

            if (style === 'color') {
                document.getElementById('carrossel-preview-content').style.color = value;
                document.getElementById('feed-preview-content').style.color = value;
            } else if (style === 'font') {
                document.getElementById('carrossel-preview-content').style.fontFamily = value;
                document.getElementById('feed-preview-content').style.fontFamily = value;
            } else if (style === 'size') {
                const newSize = (parseInt(value) * 0.7) + 'px';
                document.getElementById('carrossel-preview-content').style.fontSize = newSize;
                document.getElementById('feed-preview-content').style.fontSize = newSize;
            }
        }

        // Position quick buttons
        function setPosition(value) {
            document.getElementById('story-position-y').value = value;
            updateStoryPreview();
            updatePositionButtons();
        }

        function updatePositionButtons() {
            const value = parseInt(document.getElementById('story-position-y').value);
            const buttons = document.querySelectorAll('.btn-position');
            buttons.forEach(btn => {
                btn.classList.remove('active');
                if ((value < 35 && btn.textContent.includes('Topo')) ||
                    (value >= 35 && value <= 65 && btn.textContent.includes('Centro')) ||
                    (value > 65 && btn.textContent.includes('Rodap√©'))) {
                    btn.classList.add('active');
                }
            });
        }

        // Save functions
        async function saveStory() {
            showNotification('‚úÖ Story salva com sucesso!', 'success');
            stats.stories++;
            updateStats();
        }

        async function saveCarrossel() {
            showNotification('‚úÖ Carrossel salvo com sucesso!', 'success');
            stats.carrosseis++;
            updateStats();
        }

        async function saveFeed() {
            showNotification('‚úÖ Feed post salvo com sucesso!', 'success');
            stats.feeds++;
            updateStats();
        }

        // Publish functions
        async function publishStory() {
            showLoading(true);
            setTimeout(() => {
                showLoading(false);
                showNotification('üì§ Story publicada em Instagram!', 'success');
            }, 2000);
        }

        async function publishCarrossel() {
            showLoading(true);
            setTimeout(() => {
                showLoading(false);
                showNotification('üì§ Carrossel publicado em Instagram e LinkedIn!', 'success');
            }, 2000);
        }

        async function publishFeed() {
            showLoading(true);
            setTimeout(() => {
                showLoading(false);
                showNotification('üì§ Feed post publicado!', 'success');
            }, 2000);
        }

        // Generate with AI
        async function generateStoryAI() {
            showLoading(true);
            try {
                const sequence = document.getElementById('story-type').value;
                const procedure = document.getElementById('story-procedure').value || 'est√©tica';
                const objective = document.getElementById('story-type').value;
                const payload = {
                    procedimento: procedure,
                    objetivo: objective,
                    publico: brandProfile?.publico_principal || 'mulheres 30-50 anos buscando rejuvenescimento',
                    num_stories: 5,
                    brand_profile: brandProfile
                };

                const response = await fetch(`${API_BASE}/ai/lucresia/stories`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(errorText || 'Falha ao gerar stories');
                }

                const data = await response.json();
                showLoading(false);

                if (data?.stories?.length) {
                    const seq = {
                        name: sequence,
                        stories: data.stories.map((s) => ({
                            text: applyBrandPlaceholders(s.texto_principal || ''),
                            trigger: s.gatilho_psicologico || s.intencao_estrategica || ''
                        }))
                    };
                    generatedStories.story = seq;

                    const first = seq.stories[0];
                    document.getElementById('story-text').value = first.text;
                    document.getElementById('story-title').value = applyBrandPlaceholders(`Story ${procedure}`);
                    updateStoryPreview();
                    displayGeneratedStories('story');
                    showNotification('ü§ñ Sequ√™ncia gerada pela Lucresia!', 'success');
                } else if (data?.raw_content) {
                    const fallbackText = applyBrandPlaceholders(data.raw_content);
                    document.getElementById('story-text').value = fallbackText;
                    updateStoryPreview();
                    showNotification('‚ö†Ô∏è Lucresia retornou texto livre; revise antes de usar.', 'warning');
                } else {
                    showNotification('‚ö†Ô∏è Resposta sem stories retornados.', 'warning');
                }
            } catch (error) {
                showLoading(false);
                console.error('Erro ao gerar:', error);
                showNotification(`‚ùå Erro ao gerar com IA: ${error.message}`, 'error');
            }
        }

        async function generateCarrosselAI() {
            showLoading(true);
            try {
                const slides = document.getElementById('carrossel-slides').value;
                const type = document.getElementById('carrossel-type').value;
                
                setTimeout(() => {
                    showLoading(false);
                    showNotification('ü§ñ Carrossel com ' + slides + ' slides gerado!', 'success');
                }, 1500);
            } catch (error) {
                showLoading(false);
                showNotification('‚ùå Erro ao gerar carrossel', 'error');
            }
        }

        async function generateFeedAI() {
            showLoading(true);
            try {
                const objective = document.getElementById('feed-objective').value;
                const emotion = document.getElementById('feed-emotion').value;
                
                setTimeout(() => {
                    showLoading(false);
                    showNotification('ü§ñ 3 op√ß√µes de legenda geradas!', 'success');
                }, 1500);
            } catch (error) {
                showLoading(false);
                showNotification('‚ùå Erro ao gerar feed', 'error');
            }
        }

        // Display generated stories from AI
        function displayGeneratedStories(type) {
            if (type === 'story' && generatedStories.story) {
                const seq = generatedStories.story;
                console.log('Stories geradas:', seq.stories);
                alert(`‚úÖ Sequ√™ncia: ${seq.name}\n\nStories geradas:\n\n${seq.stories.map((s, i) => `${i+1}. "${s.text}"\n   Gatilho: ${s.trigger}`).join('\n\n')}`);
            }
        }

        function switchImageSource(source) {
            document.getElementById('image-gallery-container').style.display = source !== 'color' ? 'grid' : 'none';
            document.getElementById('image-search').style.display = source !== 'color' && source !== 'ai' ? 'block' : 'none';
            document.getElementById('ai-prompt-container').style.display = source === 'ai' ? 'block' : 'none';
            
            if (source !== 'ai' && source !== 'color') {
                loadDefaultImages(source);
            }
        }

        async function loadDefaultImages(source) {
            // Imagens padr√£o de est√©tica
            const defaultImages = [
                'https://images.unsplash.com/photo-1560750588-73207b1ef5b8?w=300&h=400&fit=crop',
                'https://images.unsplash.com/photo-1570172619644-dfd03ed5d881?w=300&h=400&fit=crop',
                'https://images.unsplash.com/photo-1487412720507-e7ab37603c6f?w=300&h=400&fit=crop',
                'https://images.unsplash.com/photo-1616394584738-fc6e612e71b9?w=300&h=400&fit=crop'
            ];
            
            const gallery = document.getElementById('image-gallery-container');
            gallery.innerHTML = defaultImages.map((img, i) => 
                `<img src="${img}" alt="imagem" onclick="selectStoryImage('${img}')" style="width: 100%; height: 100px; object-fit: cover; border-radius: 6px; cursor: pointer; border: 2px solid transparent; transition: all 0.3s;" onmouseover="this.style.borderColor='#667eea'; this.style.transform='scale(1.05)';" onmouseout="this.style.borderColor='transparent'; this.style.transform='scale(1)';">`
            ).join('');
        }

        async function searchImages() {
            const query = document.getElementById('search-images').value;
            if (!query) {
                showNotification('‚ö†Ô∏è Digite um termo de busca', 'error');
                return;
            }
            
            showLoading(true);
            try {
                // TODO: Integrar com APIs reais (Unsplash, Pexels, Pixabay)
                // Para agora, usar imagens padr√£o
                showLoading(false);
                showNotification('‚úÖ Imagens carregadas (conecte APIs reais)', 'success');
            } catch (error) {
                showLoading(false);
                showNotification('‚ùå Erro ao buscar imagens', 'error');
            }
        }

        async function generateImageWithAI() {
            const prompt = document.getElementById('ai-prompt').value;
            if (!prompt) {
                showNotification('‚ö†Ô∏è Digite uma descri√ß√£o', 'error');
                return;
            }
            
            showLoading(true);
            try {
                // TODO: Integrar com DALL-E, Midjourney ou Stable Diffusion
                setTimeout(() => {
                    showLoading(false);
                    showNotification('üé® IA: integre com DALL-E ou Midjourney', 'success');
                }, 2000);
            } catch (error) {
                showLoading(false);
                showNotification('‚ùå Erro ao gerar imagem', 'error');
            }
        }

        function selectStoryImage(imageUrl) {
            document.getElementById('story-preview-content').style.backgroundImage = `url('${imageUrl}')`;
            document.getElementById('story-preview-content').style.backgroundSize = 'cover';
            currentContent.story.background = imageUrl;
            showNotification('‚úÖ Imagem selecionada!', 'success');
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const messageElement = document.getElementById('notification-message');
            messageElement.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function updateStats() {
            document.getElementById('stat-stories').textContent = stats.stories;
            document.getElementById('stat-carrosseis').textContent = stats.carrosseis;
            document.getElementById('stat-feeds').textContent = stats.feeds;
        }

        // ===== HIST√ìRICO (UNDO/REDO) =====
        let history = [];
        let historyIndex = -1;

        function saveToHistory() {
            const activeTab = document.querySelector('.tab.active')?.textContent.trim();
            
            let state = {
                type: activeTab || 'Story',
                timestamp: Date.now()
            };
            
            if (activeTab === 'Carrossel') {
                state = {
                    ...state,
                    title: document.getElementById('carrossel-title').value,
                    description: document.getElementById('carrossel-description').value,
                    slides: document.getElementById('carrossel-slides').value,
                    bg: currentContent.carrossel.background
                };
            } else if (activeTab === 'Feed') {
                state = {
                    ...state,
                    title: document.getElementById('feed-title').value,
                    text: document.getElementById('feed-text').value,
                    bg: currentContent.feed.background
                };
            } else {
                // Story (default)
                state = {
                    ...state,
                    text: document.getElementById('story-text').value,
                    cta: document.getElementById('story-cta').value,
                    font: document.getElementById('story-font').value,
                    size: document.getElementById('story-size').value,
                    color: document.getElementById('story-color').value,
                    positionY: document.getElementById('story-position-y').value,
                    bg: currentContent.story.background,
                    filters: getFilterValues()
                };
            }
            
            history = history.slice(0, historyIndex + 1);
            history.push(state);
            historyIndex++;
        }

        function undoAction() {
            if (historyIndex > 0) {
                historyIndex--;
                loadFromHistory(history[historyIndex]);
                showNotification('‚Ü∂ A√ß√£o desfeita', 'success');
            } else {
                showNotification('‚ö†Ô∏è Nada a desfazer', 'error');
            }
        }

        function redoAction() {
            if (historyIndex < history.length - 1) {
                historyIndex++;
                loadFromHistory(history[historyIndex]);
                showNotification('‚Ü∑ A√ß√£o refeita', 'success');
            } else {
                showNotification('‚ö†Ô∏è Nada a refazer', 'error');
            }
        }

        function loadFromHistory(state) {
            if (!state) return;
            
            // Switch to correct tab
            if (state.type === 'Carrossel') {
                document.querySelector('.tab:nth-child(2)').click();
                document.getElementById('carrossel-title').value = state.title || '';
                document.getElementById('carrossel-description').value = state.description || '';
                document.getElementById('carrossel-slides').value = state.slides || 5;
                if (state.bg) {
                    document.getElementById('carrossel-preview-content').style.backgroundImage = `url('${state.bg}')`;
                }
                updateCarrosselPreview();
            } else if (state.type === 'Feed') {
                document.querySelector('.tab:nth-child(3)').click();
                document.getElementById('feed-title').value = state.title || '';
                document.getElementById('feed-text').value = state.text || '';
                if (state.bg) {
                    document.getElementById('feed-preview-content').style.backgroundImage = `url('${state.bg}')`;
                }
                updateFeedPreview();
            } else {
                // Story (default)
                document.querySelector('.tab:nth-child(1)').click();
                document.getElementById('story-text').value = state.text || '';
                document.getElementById('story-cta').value = state.cta || 'Saiba mais';
                document.getElementById('story-font').value = state.font || 'Arial';
                document.getElementById('story-size').value = state.size || 24;
                document.getElementById('story-color').value = state.color || '#000000';
                document.getElementById('story-position-y').value = state.positionY || 50;
                if (state.bg) {
                    document.getElementById('story-preview-content').style.backgroundImage = `url('${state.bg}')`;
                }
                
                if (state.filters) {
                    document.getElementById('brightness').value = state.filters.brightness || 100;
                    document.getElementById('contrast').value = state.filters.contrast || 100;
                    document.getElementById('saturation').value = state.filters.saturation || 100;
                    document.getElementById('blur').value = state.filters.blur || 0;
                    document.getElementById('sepia').value = state.filters.sepia || 0;
                    document.getElementById('grayscale').value = state.filters.grayscale || 0;
                    updateFilterValues();
                    applyAllFilters();
                }
                
                updateStoryPreview();
            }
        }

        function getFilterValues() {
            return {
                brightness: document.getElementById('brightness').value,
                contrast: document.getElementById('contrast').value,
                saturation: document.getElementById('saturation').value,
                blur: document.getElementById('blur').value,
                sepia: document.getElementById('sepia').value,
                grayscale: document.getElementById('grayscale').value
            };
        }

        // ===== FILTROS AVAN√áADOS =====
        function toggleFilters() {
            const section = document.getElementById('filters-section');
            section.style.display = section.style.display === 'none' ? 'block' : 'none';
        }

        function applyFilter(filterType) {
            const value = document.getElementById(filterType).value;
            document.getElementById(filterType + '-value').textContent = value;
            applyAllFilters();
            updatePreview();
            saveToHistory();
        }

        function applyAllFilters() {
            const brightness = document.getElementById('brightness').value;
            const contrast = document.getElementById('contrast').value;
            const saturation = document.getElementById('saturation').value;
            const blur = document.getElementById('blur').value;
            const sepia = document.getElementById('sepia').value;
            const grayscale = document.getElementById('grayscale').value;
            
            const filterString = `brightness(${brightness}%) contrast(${contrast}%) saturate(${saturation}%) blur(${blur}px) sepia(${sepia}%) grayscale(${grayscale}%)`;
            document.getElementById('story-preview-content').style.filter = filterString;
        }

        function resetFilters() {
            document.getElementById('brightness').value = 100;
            document.getElementById('contrast').value = 100;
            document.getElementById('saturation').value = 100;
            document.getElementById('blur').value = 0;
            document.getElementById('sepia').value = 0;
            document.getElementById('grayscale').value = 0;
            
            updateFilterValues();
            applyAllFilters();
            updatePreview();
            saveToHistory();
            showNotification('‚úÖ Filtros resetados', 'success');
        }

        function updateFilterValues() {
            document.getElementById('brightness-value').textContent = document.getElementById('brightness').value;
            document.getElementById('contrast-value').textContent = document.getElementById('contrast').value;
            document.getElementById('saturation-value').textContent = document.getElementById('saturation').value;
            document.getElementById('blur-value').textContent = document.getElementById('blur').value;
            document.getElementById('sepia-value').textContent = document.getElementById('sepia').value;
            document.getElementById('grayscale-value').textContent = document.getElementById('grayscale').value;
        }

        function applyPresetFilter(preset) {
            if (preset === 'vintage') {
                document.getElementById('sepia').value = 40;
                document.getElementById('saturation').value = 80;
                document.getElementById('brightness').value = 110;
            } else if (preset === 'noir') {
                document.getElementById('grayscale').value = 100;
                document.getElementById('contrast').value = 120;
            } else if (preset === 'vibrant') {
                document.getElementById('saturation').value = 150;
                document.getElementById('contrast').value = 110;
                document.getElementById('brightness').value = 105;
            }
            
            updateFilterValues();
            applyAllFilters();
            updatePreview();
            saveToHistory();
            showNotification('üé® Filtro aplicado!', 'success');
        }

        // ===== TEMPLATES PR√â-PRONTOS =====
        const TEMPLATES = {
            atrair: [
                { name: 'üî• Curiosidade', text: 'Sabe aquele segredo que as maiores celebridades da Elevare guardam?', color: '#ef4444', brand: true },
                { name: '‚ö° FOMO', text: 'Apenas 3 vagas restantes para harmoniza√ß√£o Elevare esta semana!', color: '#f59e0b', brand: true },
                { name: '‚ùì Pergunta', text: 'Qual √© o maior erro que voc√™ comete com sua pele? A Elevare tem a solu√ß√£o!', color: '#667eea', brand: true },
                { name: 'üíé Exclusivo', text: 'Acesso exclusivo Elevare Premium apenas para os 10 primeiros!', color: '#8b5cf6', brand: true }
            ],
            aquecer: [
                { name: 'üìö Educativo', text: 'Mito: Harmoniza√ß√£o Elevare deixa o rosto travado.\\n\\nVerdade: Com nossa t√©cnica, resultado natural garantido!', color: '#10b981', brand: true },
                { name: 'üë§ Prova Social', text: '"Meu resultado com Elevare superou todas as expectativas!" - Marina S.', color: '#06b6d4', brand: true },
                { name: '‚úÖ Benef√≠cio', text: '‚úì T√©cnica Elevare Premium\\n‚úì Sem recupera√ß√£o\\n‚úì Resultado em 24h', color: '#10b981', brand: true },
                { name: 'üíÑ Procedimento', text: 'Harmoniza√ß√£o Facial Elevare: O que esperar na sua primeira sess√£o de transforma√ß√£o', color: '#667eea', brand: true }
            ],
            converter: [
                { name: 'üí∞ Oferta', text: 'De R$800 pela Harmoniza√ß√£o Elevare\\nPor R$450\\n\\n‚úì Frete gr√°tis\\n‚úì Parcelado em 3x', color: '#ef4444', brand: true },
                { name: '‚è∞ Urg√™ncia', text: 'Promo√ß√£o Elevare v√°lida apenas hoje!\\n\\n√öltimas 5 vagas de harmoniza√ß√£o', color: '#f59e0b', brand: true },
                { name: 'üéÅ B√¥nus', text: 'Contratar com Elevare agora e ganhe:\\n+ Consultoria com especialista\\n+ Kit Elevare completo', color: '#8b5cf6', brand: true },
                { name: 'üìû CTA', text: 'Agende sua transforma√ß√£o Elevare agora\\n\\nTelefone | WhatsApp | Instagram @elevare', color: '#667eea', brand: true }
            ]
        };

        function toggleTemplates() {
            const section = document.getElementById('templates-section');
            section.style.display = section.style.display === 'none' ? 'block' : 'none';
            
            if (section.style.display !== 'none') {
                loadTemplates();
            }
        }

        function loadTemplates() {
            const sequence = document.getElementById('story-type').value;
            const templateList = TEMPLATES[sequence] || TEMPLATES.atrair;
            const grid = document.getElementById('templates-grid');
            
            grid.innerHTML = templateList.map((t, i) => `
                <div class="template-item" onclick="applyTemplate('${sequence}', ${i})">
                    <div class="template-item-preview">${t.name.charAt(0)}</div>
                    <div style="font-weight: 500; color: #333;">${t.name.split(' ')[1]}</div>
                </div>
            `).join('');
        }

        function applyTemplate(sequence, index) {
            const template = TEMPLATES[sequence][index];
            document.getElementById('story-text').value = template.text;
            selectColor('story', template.color);
            document.getElementById('templates-section').style.display = 'none';
            updatePreview();
            saveToHistory();
            showNotification(`‚úÖ Template "${template.name}" aplicado!`, 'success');
        }

        // ===== COPIAR APENAS TEXTO =====
        async function copyTextOnly() {
            // Use currentTab for reliability
            const typeTitle = getCurrentTypeTitle();
            let textToCopy = '';
            
            if (typeTitle === 'Story') {
                textToCopy = document.getElementById('story-text').value;
            } else if (typeTitle === 'Carrossel') {
                textToCopy = document.getElementById('carrossel-description').value;
            } else if (typeTitle === 'Feed') {
                textToCopy = document.getElementById('feed-text').value;
            }
            
            if (!textToCopy || textToCopy.trim() === '') {
                showNotification('‚ùå Nenhum texto para copiar!', 'error');
                return;
            }
            
            try {
                await navigator.clipboard.writeText(textToCopy.trim());
                showNotification('‚úÖ Texto copiado com sucesso!', 'success');
            } catch (err) {
                showNotification('‚ùå Erro ao copiar texto', 'error');
            }
        }

        // ===== EXPORTA√á√ÉO DIRETA =====
        async function exportStory() {
            showLoading(true);
            try {
                const format = confirm('PNG (OK) ou JPG (CANCELAR)?') ? 'png' : 'jpg';
                const element = document.getElementById('story-preview-content');
                
                // Criar canvas
                const canvas = document.createElement('canvas');
                const width = 1080;
                const height = 1920;
                canvas.width = width;
                canvas.height = height;
                
                const ctx = canvas.getContext('2d');
                
                // Preencher fundo
                const bgColor = window.getComputedStyle(element).backgroundColor;
                ctx.fillStyle = bgColor !== 'rgba(0, 0, 0, 0)' ? bgColor : '#ffffff';
                ctx.fillRect(0, 0, width, height);
                
                // Desenhar imagem de fundo
                const bgImage = window.getComputedStyle(element).backgroundImage;
                if (bgImage !== 'none') {
                    await drawBackgroundImage(ctx, bgImage, width, height);
                }
                
                // Aplicar filtros e desenhar texto
                const filters = window.getComputedStyle(element).filter;
                if (filters !== 'none') ctx.filter = filters;
                
                drawStoryText(ctx, width, height);
                
                // Download
                canvas.toBlob((blob) => {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `story-elevare-${new Date().getTime()}.${format}`;
                    link.click();
                    URL.revokeObjectURL(url);
                    
                    showLoading(false);
                    showNotification(`‚úÖ Story exportado em ${format.toUpperCase()}! üì•`, 'success');
                    stats.stories++;
                    updateStats();
                }, `image/${format}`, format === 'jpg' ? 0.95 : 1);
            } catch (error) {
                showLoading(false);
                showNotification('‚ùå Erro ao exportar', 'error');
                console.error(error);
            }
        }

        function drawBackgroundImage(ctx, bgImage, width, height) {
            return new Promise((resolve) => {
                try {
                    const url = bgImage.match(/url\\(['\"]?([^'\"\\)]+)['\"]?\\)/)?.[1];
                    if (!url) {
                        resolve();
                        return;
                    }
                    
                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                    img.onload = () => {
                        ctx.drawImage(img, 0, 0, width, height);
                        resolve();
                    };
                    img.onerror = () => resolve();
                    img.src = url;
                } catch (e) {
                    resolve();
                }
            });
        }

        function drawStoryText(ctx, width, height) {
            const text = document.getElementById('story-text').value;
            if (!text) return;
            
            const fontSize = parseInt(document.getElementById('story-size').value) || 32;
            const font = document.getElementById('story-font').value || 'Inter';
            const color = document.getElementById('story-color').value || '#ffffff';
            const alignment = document.getElementById('story-alignment').value || 'center';
            const hasShadow = document.getElementById('story-shadow')?.checked;
            
            ctx.font = `${fontSize}px ${font}`;
            ctx.fillStyle = color;
            ctx.textAlign = alignment;
            
            if (hasShadow) {
                ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                ctx.shadowBlur = 10;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
            }
            
            const x = alignment === 'left' ? 50 : alignment === 'right' ? width - 50 : width / 2;
            const lines = text.split('\\n');
            const lineHeight = fontSize * 1.4;
            const startY = (height - lines.length * lineHeight) / 2;
            
            lines.forEach((line, i) => {
                ctx.fillText(line, x, startY + i * lineHeight);
            });
        }

        // Atalhos de teclado
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                if (e.key === 'z') {
                    e.preventDefault();
                    undoAction();
                } else if (e.key === 'y') {
                    e.preventDefault();
                    redoAction();
                } else if (e.key === 's') {
                    e.preventDefault();
                    saveStory();
                }
            }
        });
    </script>
</body>
</html>
